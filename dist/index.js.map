{"version":3,"file":"index.js","mappings":"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","sources":["webpack://grapesjs-plugin-scribejs/webpack/universalModuleDefinition","webpack://grapesjs-plugin-scribejs/webpack/bootstrap","webpack://grapesjs-plugin-scribejs/webpack/runtime/define property getters","webpack://grapesjs-plugin-scribejs/webpack/runtime/hasOwnProperty shorthand","webpack://grapesjs-plugin-scribejs/webpack/runtime/make namespace object","webpack://grapesjs-plugin-scribejs/./node_modules/scribejs-editor/dist/index.js","webpack://grapesjs-plugin-scribejs/./src/instance-manager.ts","webpack://grapesjs-plugin-scribejs/./src/toolbar.ts","webpack://grapesjs-plugin-scribejs/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"grapesjs-plugin-scribejs\"] = factory();\n\telse\n\t\troot[\"grapesjs-plugin-scribejs\"] = factory();\n})(Object(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : this)), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/* scribejs-editor v1.0.1 */\nvar S=class{constructor(e,t){this.savedSnapshots=[];this.isComposing=!1;this.doc=e,this.contentEl=t,t.addEventListener(\"compositionstart\",()=>{this.isComposing=!0}),t.addEventListener(\"compositionend\",()=>{this.isComposing=!1})}get composing(){return this.isComposing}isSelectionInContent(){if(this.isComposing)return!1;let e=this.doc.getSelection();if(!e||e.rangeCount===0)return!1;let t=e.getRangeAt(0);return this.contentEl.contains(t.commonAncestorContainer)}getSelection(){if(this.isComposing)return null;let e=this.doc.getSelection();if(!e||e.rangeCount===0)return null;let t=e.getRangeAt(0);if(!this.contentEl.contains(t.commonAncestorContainer))return null;t=this.normalizeRange(t);let o=e.toString(),i=t.collapsed,a=null;if(!i){let d=t.getClientRects();if(d.length>0){let s=d[0],g=d[d.length-1],h=Math.min(s.left,g.left),C=s.top,p=Math.max(s.right,g.right),y=g.bottom;a=new DOMRect(h,C,p-h,y-C)}}return{range:t.cloneRange(),collapsed:i,text:o,rect:a,formats:this.getFormats(t)}}normalizeRange(e){let t=e.cloneRange();if(t.collapsed)return t;if(t.startContainer.nodeType===Node.TEXT_NODE&&t.startOffset===t.startContainer.length&&t.startContainer.nextSibling&&t.setStartBefore(t.startContainer.nextSibling),t.endContainer===this.contentEl&&t.endOffset>0){let o=this.contentEl.childNodes[t.endOffset-1];o&&t.setEndAfter(o)}if(t.endOffset===0&&t.endContainer!==this.contentEl){let o=t.endContainer;t.setEndBefore(o)}if(t.endContainer.nodeType===Node.ELEMENT_NODE&&t.endOffset>0){let o=t.endContainer.childNodes[t.endOffset-1];o&&o.nodeName===\"BR\"&&t.setEndBefore(o)}return t}getFormats(e){let t=this.doc.getSelection();if(!t||t.rangeCount===0)return this.getDefaultFormats();let o=e||t.getRangeAt(0),i=o.commonAncestorContainer;if(!o.collapsed){let p=o.startContainer,y=o.startOffset;if(p.nodeType===Node.TEXT_NODE&&y===p.length){let E=p.nextSibling;E&&(p=E,y=0)}for(;p.nodeType===Node.ELEMENT_NODE&&p.childNodes.length>y;){let E=p.childNodes[y];if(!E)break;if(E.nodeType===Node.TEXT_NODE&&!E.textContent?.trim()&&E.nextSibling){p=E.nextSibling,y=0;continue}p=E,y=0}i=p}let a=i.nodeType===Node.TEXT_NODE?i.parentElement:i;if(!a||a!==this.contentEl&&!this.contentEl.contains(a))return this.getDefaultFormats();let s=(a.ownerDocument.defaultView||window).getComputedStyle(a),g=s.textDecorationLine||s.textDecoration||\"\",h=s.fontWeight,C=h===\"bold\"||h===\"bolder\"||parseInt(h)>=700;return{bold:this.hasTag(a,\"b\")||this.hasTag(a,\"strong\")||C,italic:this.hasTag(a,\"i\")||this.hasTag(a,\"em\")||s.fontStyle===\"italic\",underline:this.hasTag(a,\"u\")||g.includes(\"underline\"),strike:this.hasTag(a,\"s\")||this.hasTag(a,\"strike\")||this.hasTag(a,\"del\")||g.includes(\"line-through\"),code:this.hasTag(a,\"code\"),subscript:this.hasTag(a,\"sub\"),superscript:this.hasTag(a,\"sup\"),link:this.getLinkUrl(a),heading:this.getHeadingLevel(a),list:this.getListType(a),blockquote:this.hasTag(a,\"blockquote\"),align:this.getAlignment(a,s),fontSize:s.fontSize||null,fontFamily:s.fontFamily||null,color:s.color||null,backgroundColor:this.getExplicitBackground(a)}}getDefaultFormats(){return{bold:!1,italic:!1,underline:!1,strike:!1,code:!1,subscript:!1,superscript:!1,link:null,heading:null,list:null,blockquote:!1,align:\"left\",fontSize:null,fontFamily:null,color:null,backgroundColor:null}}getExplicitBackground(e){let t=e;for(;t&&t!==this.contentEl;){let o=t.style.backgroundColor;if(o&&o!==\"transparent\"&&o!==\"\"||t.tagName.toLowerCase()===\"span\"&&o)return o;t=t.parentElement}return null}hasTag(e,t){let o=e;for(;o&&o!==this.contentEl;){if(o.tagName.toLowerCase()===t.toLowerCase())return!0;o=o.parentElement}return!1}getLinkUrl(e){let t=e;for(;t&&t!==this.contentEl;){if(t.tagName.toLowerCase()===\"a\")return t.href||null;t=t.parentElement}return null}getHeadingLevel(e){let t=e;for(;t&&t!==this.contentEl;){let o=t.tagName.match(/^H([1-6])$/i);if(o)return parseInt(o[1]);t=t.parentElement}return null}getListType(e){let t=e;for(;t&&t!==this.contentEl;){if(t.tagName.toLowerCase()===\"ol\")return\"ordered\";if(t.tagName.toLowerCase()===\"ul\")return\"unordered\";t=t.parentElement}return null}getAlignment(e,t){let o=e;for(;o&&o!==this.contentEl;){let i=o.style.textAlign;if(i&&i!==\"inherit\"&&i!==\"\"){let g=this.mapAlign(i);if(g)return g}let a=o.getAttribute(\"align\");if(a){let g=this.mapAlign(a);if(g)return g}let d=o.tagName.toLowerCase();if([\"p\",\"div\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"li\",\"blockquote\",\"article\",\"section\"].includes(d)){let g=window.getComputedStyle(o).textAlign,h=this.mapAlign(g);if(h)return h}o=o.parentElement}return this.mapAlign(t.textAlign)||\"left\"}mapAlign(e){if(!e)return null;let t=e.toLowerCase();return t===\"center\"||t.includes(\"center\")?\"center\":t===\"right\"||t===\"end\"?\"right\":t===\"justify\"||t===\"full\"?\"justify\":t===\"left\"||t===\"start\"?\"left\":null}saveSelection(e=\"manual\"){if(this.isComposing)return;let t=this.doc.getSelection();if(t&&t.rangeCount>0){let o=t.getRangeAt(0);this.savedSnapshots.push({range:this.normalizeRange(o),timestamp:Date.now(),reason:e})}}restoreSelection(){let e=this.savedSnapshots.pop();if(!e)return!1;let t=this.doc.getSelection();return t?(t.removeAllRanges(),t.addRange(e.range),!0):!1}clearSavedSelections(){this.savedSnapshots=[]}get snapshotCount(){return this.savedSnapshots.length}setSelection(e){let t=this.doc.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}selectAll(){let e=this.doc.createRange();e.selectNodeContents(this.contentEl),this.setSelection(e)}collapse(e=!1){let t=this.doc.getSelection();!t||t.rangeCount===0||(e?t.collapseToStart():t.collapseToEnd())}getCursorPosition(){let e=this.doc.getSelection();if(!e||e.rangeCount===0)return null;let t=e.getRangeAt(0),o=t.getBoundingClientRect();if(o.width===0&&o.height===0){let i=this.doc.createElement(\"span\");i.textContent=\"\\u200B\",t.insertNode(i);let a=i.getBoundingClientRect();return i.parentNode?.removeChild(i),{top:a.top,left:a.left,height:a.height||20}}return{top:o.top,left:o.left,height:o.height}}getSelectionRect(){let e=this.doc.getSelection();return!e||e.rangeCount===0?null:e.getRangeAt(0).getBoundingClientRect()}getSelectionOffsets(){let e=this.getSelection();if(!e||!e.range)return null;let t=e.range,o=t.cloneRange();o.selectNodeContents(this.contentEl),o.setEnd(t.startContainer,t.startOffset);let i=o.toString().length;return{start:i,end:i+t.toString().length}}};var J=[\"p\",\"br\",\"hr\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"strong\",\"b\",\"em\",\"i\",\"u\",\"s\",\"strike\",\"del\",\"sup\",\"sub\",\"code\",\"pre\",\"blockquote\",\"q\",\"ul\",\"ol\",\"li\",\"a\",\"img\",\"table\",\"thead\",\"tbody\",\"tfoot\",\"tr\",\"th\",\"td\",\"div\",\"span\",\"figure\",\"figcaption\"],X={\"*\":[\"class\",\"id\",\"style\",\"data-*\"],a:[\"href\",\"target\",\"rel\",\"title\"],img:[\"src\",\"alt\",\"width\",\"height\",\"title\"],td:[\"colspan\",\"rowspan\"],th:[\"colspan\",\"rowspan\",\"scope\"]},$=[\"http\",\"https\",\"mailto\",\"tel\"],Z=[\"script\",\"style\",\"iframe\",\"object\",\"embed\",\"form\",\"input\",\"button\"],v=class{constructor(e={}){this.config={allowedTags:e.allowedTags||J,allowedAttributes:e.allowedAttributes||X,allowedSchemes:e.allowedSchemes||$,stripEmpty:e.stripEmpty??!0}}sanitize(e){let o=new DOMParser().parseFromString(e,\"text/html\").body;return this.processNode(o),o.innerHTML}processNode(e){let t=Array.from(e.childNodes);for(let s=t.length-1;s>=0;s--)this.processNode(t[s]);if(e.nodeType!==Node.ELEMENT_NODE)return;let o=e,i=o.tagName.toLowerCase();if(Z.includes(i)){o.remove();return}if(!this.config.allowedTags.includes(i)){let s=o.parentNode;if(s){for(;o.firstChild;)s.insertBefore(o.firstChild,o);o.remove()}return}let a=this.getAllowedAttributes(i),d=Array.from(o.attributes);for(let s of d){if(!this.isAttributeAllowed(s.name,a)){o.removeAttribute(s.name);continue}[\"href\",\"src\"].includes(s.name)&&(this.isUrlSafe(s.value)||o.removeAttribute(s.name)),s.name.startsWith(\"on\")&&o.removeAttribute(s.name),s.name===\"style\"&&o.setAttribute(\"style\",this.sanitizeStyle(s.value))}this.config.stripEmpty&&this.isEmpty(o)&&![\"br\",\"hr\",\"img\"].includes(i)&&o.remove()}getAllowedAttributes(e){let t=this.config.allowedAttributes[\"*\"]||[],o=this.config.allowedAttributes[e]||[];return[...t,...o]}isAttributeAllowed(e,t){if(t.includes(e))return!0;for(let o of t)if(o.endsWith(\"*\")){let i=o.slice(0,-1);if(e.startsWith(i))return!0}return!1}isUrlSafe(e){try{if(e.startsWith(\"/\")||e.startsWith(\"./\")||e.startsWith(\"../\")||e.startsWith(\"data:image/\"))return!0;let o=new URL(e,\"http://example.com\").protocol.slice(0,-1);return this.config.allowedSchemes.includes(o)}catch{return!1}}sanitizeStyle(e){let t=[\"expression\",\"javascript:\",\"behavior\",\"binding\",\"-moz-binding\",\"url(\"],o=e;for(let i of t){let a=new RegExp(i.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\"),\"gi\");o=o.replace(a,\"\")}return o}isEmpty(e){return e.textContent?.trim()===\"\"&&e.children.length===0}sanitizePaste(e){let t=e.replace(/<o:p[^>]*>[\\s\\S]*?<\\/o:p>/gi,\"\").replace(/<\\/?o:[^>]*>/gi,\"\").replace(/<!--\\[if[^\\]]*\\]>[\\s\\S]*?<!\\[endif\\]-->/gi,\"\").replace(/<!--[\\s\\S]*?-->/g,\"\").replace(/<\\/?xml[^>]*>/gi,\"\").replace(/<\\/?st1:[^>]*>/gi,\"\").replace(/class=\"Mso[^\"]*\"/gi,\"\").replace(/style=\"[^\"]*mso-[^\"]*\"/gi,\"\");return t=t.replace(/class=\"[^\"]*docs-[^\"]*\"/gi,\"\").replace(/id=\"docs-[^\"]*\"/gi,\"\"),t=t.replace(/\\s+/g,\" \").replace(/>\\s+</g,\"><\"),this.sanitize(t)}};var k=class{constructor(e=100){this.stack=[];this.position=-1;this.debounceTimer=null;this.debounceDelay=300;this.lastContent=\"\";this.maxSize=e}push(e,t){e!==this.lastContent&&(this.lastContent=e,this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.addEntry(e,t)},this.debounceDelay))}pushImmediate(e,t){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),e!==this.lastContent&&(this.lastContent=e,this.addEntry(e,t))}addEntry(e,t){this.stack=this.stack.slice(0,this.position+1),this.stack.push({html:e,selection:t,timestamp:Date.now()}),this.stack.length>this.maxSize?this.stack.shift():this.position++}undo(){return this.canUndo()?(this.position--,this.stack[this.position]):null}redo(){return this.canRedo()?(this.position++,this.stack[this.position]):null}canUndo(){return this.position>0}canRedo(){return this.position<this.stack.length-1}getCurrent(){return this.position<0||this.position>=this.stack.length?null:this.stack[this.position]}clear(){this.stack=[],this.position=-1,this.lastContent=\"\",this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)}getStackSize(){return this.stack.length}getPosition(){return this.position}};var x=class n{static{this.INLINE_TAGS=new Set([\"strong\",\"b\",\"em\",\"i\",\"u\",\"s\",\"strike\",\"del\",\"sub\",\"sup\",\"code\",\"span\",\"a\",\"mark\"])}static{this.PRESERVE_EMPTY=new Set([\"br\",\"hr\",\"img\",\"input\"])}constructor(e){this.contentEl=e}normalize(){this.mergeAdjacentInlines(this.contentEl),this.removeEmptyNodes(this.contentEl),this.flattenNestedInlines(this.contentEl),this.cleanWhitespace(this.contentEl),this.removeBrowserJunk(this.contentEl),this.contentEl.normalize()}mergeAdjacentInlines(e){let t=Array.from(e.childNodes);for(let i=0;i<t.length-1;i++){let a=t[i],d=t[i+1];if(a.nodeType===Node.ELEMENT_NODE&&d.nodeType===Node.ELEMENT_NODE){let s=a,g=d;if(this.canMerge(s,g)){for(;g.firstChild;)s.appendChild(g.firstChild);g.remove(),i--;continue}}a.nodeType===Node.ELEMENT_NODE&&this.mergeAdjacentInlines(a)}let o=e.lastChild;o&&o.nodeType===Node.ELEMENT_NODE&&this.mergeAdjacentInlines(o)}canMerge(e,t){if(e.tagName!==t.tagName||!n.INLINE_TAGS.has(e.tagName.toLowerCase())||e.attributes.length!==t.attributes.length)return!1;for(let o=0;o<e.attributes.length;o++){let i=e.attributes[o];if(t.getAttribute(i.name)!==i.value)return!1}return!0}removeEmptyNodes(e){let t=Array.from(e.childNodes);for(let o of t)if(o.nodeType===Node.ELEMENT_NODE){let i=o,a=i.tagName.toLowerCase();this.removeEmptyNodes(i),n.INLINE_TAGS.has(a)&&!n.PRESERVE_EMPTY.has(a)&&!i.hasChildNodes()&&!i.textContent?.trim()&&i.remove()}}flattenNestedInlines(e){let t=Array.from(e.childNodes);for(let o of t){if(o.nodeType!==Node.ELEMENT_NODE)continue;let i=o,a=i.tagName.toLowerCase();if(this.flattenNestedInlines(i),!!n.INLINE_TAGS.has(a)&&i.childNodes.length===1&&i.firstChild?.nodeType===Node.ELEMENT_NODE){let d=i.firstChild;if(d.tagName===i.tagName&&this.canMerge(i,d)){for(;d.firstChild;)i.insertBefore(d.firstChild,d);d.remove()}}}}cleanWhitespace(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),o=[],i;for(;i=t.nextNode();)o.push(i);for(let a of o){let d=a.textContent||\"\";this.isInsidePreformatted(a)||(d=d.replace(/\\u00A0{2,}/g,s=>\" \".repeat(s.length)),d=d.replace(/ {3,}/g,\"  \"),d!==a.textContent&&(a.textContent=d))}}removeBrowserJunk(e){let t=Array.from(e.childNodes);for(let o of t){if(o.nodeType===Node.TEXT_NODE){if(o.textContent===\"\\u200B\"||o.textContent===\"\\uFEFF\"){o.remove();continue}o.textContent&&/[\\u200B\\uFEFF]/.test(o.textContent)&&(o.textContent=o.textContent.replace(/[\\u200B\\uFEFF]/g,\"\"))}if(o.nodeType===Node.ELEMENT_NODE){let i=o;if(i.tagName.toLowerCase()===\"span\"&&!i.hasAttribute(\"style\")&&!i.hasAttribute(\"class\")&&!i.hasAttribute(\"data-type\")&&i.attributes.length===0){for(;i.firstChild;)i.parentNode?.insertBefore(i.firstChild,i);i.remove();continue}this.removeBrowserJunk(i)}}}isInsidePreformatted(e){let t=e.parentNode;for(;t&&t!==this.contentEl;){if(t.nodeType===Node.ELEMENT_NODE){let o=t.tagName.toLowerCase();if(o===\"pre\"||o===\"code\")return!0}t=t.parentNode}return!1}};var w={bold:n=>{n.getDocument().execCommand(\"bold\",!1)},italic:n=>{n.getDocument().execCommand(\"italic\",!1)},underline:n=>{n.getDocument().execCommand(\"underline\",!1)},strike:n=>{n.getDocument().execCommand(\"strikeThrough\",!1)},subscript:n=>{n.getDocument().execCommand(\"subscript\",!1)},superscript:n=>{n.getDocument().execCommand(\"superscript\",!1)},code:n=>{let e=n.getSelection();if(!e||e.collapsed)return;let t=n.getDocument(),o=e.range;if(o)if(e.formats.code){let i=U(o.commonAncestorContainer,\"code\");if(i){let a=i.parentNode;for(;i.firstChild;)a?.insertBefore(i.firstChild,i);i.remove()}}else{let i=t.createElement(\"code\");i.appendChild(o.extractContents()),o.insertNode(i)}},clearFormat:n=>{n.getDocument().execCommand(\"removeFormat\",!1)},heading:(n,e)=>{let t=e?`h${e}`:\"p\";n.getDocument().execCommand(\"formatBlock\",!1,t)},paragraph:n=>{n.getDocument().execCommand(\"formatBlock\",!1,\"p\")},blockquote:n=>{n.getSelection()?.formats.blockquote?n.getDocument().execCommand(\"formatBlock\",!1,\"p\"):n.getDocument().execCommand(\"formatBlock\",!1,\"blockquote\")},codeBlock:n=>{n.getDocument().execCommand(\"formatBlock\",!1,\"pre\")},orderedList:n=>{n.getDocument().execCommand(\"insertOrderedList\",!1)},unorderedList:n=>{n.getDocument().execCommand(\"insertUnorderedList\",!1)},alignLeft:n=>{n.getDocument().execCommand(\"justifyLeft\",!1)},alignCenter:n=>{n.getDocument().execCommand(\"justifyCenter\",!1)},alignRight:n=>{n.getDocument().execCommand(\"justifyRight\",!1)},alignJustify:n=>{n.getDocument().execCommand(\"justifyFull\",!1)},indent:n=>{n.getDocument().execCommand(\"indent\",!1)},outdent:n=>{n.getDocument().execCommand(\"outdent\",!1)},link:(n,e)=>{if(typeof e!=\"string\")return;let t=n.getSelection();if(t)if(t.formats.link){let o=t.range;if(!o)return;let i=U(o.commonAncestorContainer,\"a\");i&&(i.href=e)}else t.collapsed||n.getDocument().execCommand(\"createLink\",!1,e)},unlink:n=>{n.getDocument().execCommand(\"unlink\",!1)},insertHR:n=>{n.getDocument().execCommand(\"insertHorizontalRule\",!1)},insertHTML:(n,e)=>{typeof e==\"string\"&&n.getDocument().execCommand(\"insertHTML\",!1,e)},insertText:(n,e)=>{typeof e==\"string\"&&n.getDocument().execCommand(\"insertText\",!1,e)},selectAll:n=>{n.getDocument().execCommand(\"selectAll\",!1)},undo:n=>{n.emit(\"undo\")},redo:n=>{n.emit(\"redo\")},setFontSize:(n,e)=>{if(typeof e!=\"string\"&&typeof e!=\"number\")return;let t=n.getSelection();if(!t||t.collapsed)return;let o=n.getDocument(),i=t.range;if(!i)return;let a=o.createElement(\"span\");a.style.fontSize=typeof e==\"number\"?`${e}px`:e,a.appendChild(i.extractContents()),i.insertNode(a)},setFontFamily:(n,e)=>{typeof e==\"string\"&&n.getDocument().execCommand(\"fontName\",!1,e)},setColor:(n,e)=>{typeof e==\"string\"&&n.getDocument().execCommand(\"foreColor\",!1,e)},setBackgroundColor:(n,e)=>{typeof e==\"string\"&&n.getDocument().execCommand(\"hiliteColor\",!1,e)}};function U(n,e){let t=n;for(;t;){if(t.nodeType===Node.ELEMENT_NODE&&t.tagName.toLowerCase()===e.toLowerCase())return t;t=t.parentNode}return null}var H=[{key:\"b\",ctrl:!0,command:\"bold\"},{key:\"i\",ctrl:!0,command:\"italic\"},{key:\"u\",ctrl:!0,command:\"underline\"},{key:\"z\",ctrl:!0,command:\"undo\"},{key:\"z\",ctrl:!0,shift:!0,command:\"redo\"},{key:\"y\",ctrl:!0,command:\"redo\"},{key:\"\\\\\",ctrl:!0,command:\"clearFormat\"},{key:\"k\",ctrl:!0,command:\"link\"}];var L=class{constructor(){this.commands=new Map}register(e){this.commands.set(e.name,e)}registerAll(e){e.forEach(t=>this.register(t))}get(e){return this.commands.get(e)}has(e){return this.commands.has(e)}getHandler(e){return this.commands.get(e)?.handler}getCommandState(e,t,o,i){let a=this.commands.get(e);if(!a)return null;let d=a.isActive?a.isActive(t):!1,s=!i,g=!i&&(!a.requiresSelection||o)&&(a.isEnabled?a.isEnabled({format:t,hasSelection:o,readOnly:i}):!0),h=a.getAttributes?a.getAttributes(t):void 0;return{name:a.name,label:a.label,category:a.category,type:a.type,active:d,supported:s,enabled:g,attributes:h,shortcut:a.shortcut,exclusiveGroup:a.exclusiveGroup,floatingToolbar:a.floatingToolbar,fixedToolbar:a.fixedToolbar,icon:a.icon,toolbarGroup:a.toolbarGroup,defaultArgs:a.defaultArgs}}getAllCommandStates(e,t,o){let i=[];return this.commands.forEach((a,d)=>{let s=this.getCommandState(d,e,t,o);s&&i.push(s)}),i}getToolbarCommands(e,t,o,i){let a=[];return this.commands.forEach((d,s)=>{if(!(e===\"floating\"?d.floatingToolbar:d.fixedToolbar))return;let h=this.getCommandState(s,t,o,i);h&&a.push(h)}),a}getNames(){return Array.from(this.commands.keys())}getByCategory(e){let t=[];return this.commands.forEach(o=>{o.category===e&&t.push(o)}),t}getExclusiveGroup(e){let t=[];return this.commands.forEach(o=>{o.exclusiveGroup===e&&t.push(o)}),t}};function R(n){return[{name:\"undo\",label:\"Undo\",category:\"history\",type:\"action\",handler:n.undo,icon:\"undo\",toolbarGroup:\"history\",shortcut:\"Ctrl+Z\",fixedToolbar:!0},{name:\"redo\",label:\"Redo\",category:\"history\",type:\"action\",handler:n.redo,icon:\"redo\",toolbarGroup:\"history\",shortcut:\"Ctrl+Shift+Z\",fixedToolbar:!0},{name:\"bold\",label:\"Bold\",category:\"inline\",type:\"toggle\",handler:n.bold,icon:\"bold\",toolbarGroup:\"format\",isActive:e=>e.bold,isEnabled:({format:e})=>!e.code,shortcut:\"Ctrl+B\",floatingToolbar:!0,fixedToolbar:!0},{name:\"italic\",label:\"Italic\",category:\"inline\",type:\"toggle\",handler:n.italic,icon:\"italic\",toolbarGroup:\"format\",isActive:e=>e.italic,isEnabled:({format:e})=>!e.code,shortcut:\"Ctrl+I\",floatingToolbar:!0,fixedToolbar:!0},{name:\"underline\",label:\"Underline\",category:\"inline\",type:\"toggle\",handler:n.underline,icon:\"underline\",toolbarGroup:\"format\",isActive:e=>e.underline,isEnabled:({format:e})=>!e.code,shortcut:\"Ctrl+U\",floatingToolbar:!0,fixedToolbar:!0},{name:\"strike\",label:\"Strikethrough\",category:\"inline\",type:\"toggle\",handler:n.strike,icon:\"strikethrough\",toolbarGroup:\"format\",isActive:e=>e.strike,isEnabled:({format:e})=>!e.code,floatingToolbar:!0,fixedToolbar:!0},{name:\"code\",label:\"Inline Code\",category:\"inline\",type:\"toggle\",handler:n.code,icon:\"code\",toolbarGroup:\"format\",isActive:e=>e.code,isEnabled:({format:e})=>!e.bold&&!e.italic,requiresSelection:!0,floatingToolbar:!0,fixedToolbar:!0},{name:\"subscript\",label:\"Subscript\",category:\"inline\",type:\"toggle\",handler:n.subscript,isActive:e=>e.subscript},{name:\"superscript\",label:\"Superscript\",category:\"inline\",type:\"toggle\",handler:n.superscript,isActive:e=>e.superscript},{name:\"clearFormat\",label:\"Clear Formatting\",category:\"inline\",type:\"action\",handler:n.clearFormat,icon:\"removeFormatting\",toolbarGroup:\"misc\",shortcut:\"Ctrl+\\\\\",fixedToolbar:!0},{name:\"link\",label:\"Link\",category:\"insert\",type:\"apply\",handler:n.link,icon:\"link\",toolbarGroup:\"insert\",isActive:e=>!!e.link,getAttributes:e=>e.link?{url:e.link}:void 0,shortcut:\"Ctrl+K\",floatingToolbar:!0,fixedToolbar:!0},{name:\"unlink\",label:\"Unlink\",category:\"insert\",type:\"action\",handler:n.unlink,isActive:e=>!!e.link},{name:\"heading1\",label:\"Heading 1\",category:\"block\",type:\"apply\",handler:n.heading,icon:\"heading1\",toolbarGroup:\"block\",isActive:e=>e.heading===1,exclusiveGroup:\"blockType\",defaultArgs:[1],floatingToolbar:!0,fixedToolbar:!0},{name:\"heading2\",label:\"Heading 2\",category:\"block\",type:\"apply\",handler:n.heading,icon:\"heading2\",toolbarGroup:\"block\",isActive:e=>e.heading===2,exclusiveGroup:\"blockType\",defaultArgs:[2],floatingToolbar:!0,fixedToolbar:!0},{name:\"heading3\",label:\"Heading 3\",category:\"block\",type:\"apply\",handler:n.heading,icon:\"heading3\",toolbarGroup:\"block\",isActive:e=>e.heading===3,exclusiveGroup:\"blockType\",defaultArgs:[3],fixedToolbar:!0},{name:\"heading\",label:\"Heading\",category:\"block\",type:\"apply\",handler:n.heading,isActive:e=>e.heading!==null,exclusiveGroup:\"blockType\"},{name:\"paragraph\",label:\"Paragraph\",category:\"block\",type:\"apply\",handler:n.paragraph,exclusiveGroup:\"blockType\"},{name:\"blockquote\",label:\"Blockquote\",category:\"block\",type:\"toggle\",handler:n.blockquote,icon:\"quote\",toolbarGroup:\"block\",isActive:e=>e.blockquote,floatingToolbar:!0,fixedToolbar:!0},{name:\"codeBlock\",label:\"Code Block\",category:\"block\",type:\"apply\",handler:n.codeBlock,exclusiveGroup:\"blockType\"},{name:\"unorderedList\",label:\"Bullet List\",category:\"list\",type:\"toggle\",handler:n.unorderedList,icon:\"list\",toolbarGroup:\"list\",isActive:e=>e.list===\"unordered\",exclusiveGroup:\"listType\",floatingToolbar:!0,fixedToolbar:!0},{name:\"orderedList\",label:\"Numbered List\",category:\"list\",type:\"toggle\",handler:n.orderedList,icon:\"listOrdered\",toolbarGroup:\"list\",isActive:e=>e.list===\"ordered\",exclusiveGroup:\"listType\",floatingToolbar:!0,fixedToolbar:!0},{name:\"alignLeft\",label:\"Align Left\",category:\"alignment\",type:\"apply\",handler:n.alignLeft,icon:\"alignLeft\",toolbarGroup:\"align\",isActive:e=>e.align===\"left\",exclusiveGroup:\"alignment\",fixedToolbar:!0},{name:\"alignCenter\",label:\"Align Center\",category:\"alignment\",type:\"apply\",handler:n.alignCenter,icon:\"alignCenter\",toolbarGroup:\"align\",isActive:e=>e.align===\"center\",exclusiveGroup:\"alignment\",fixedToolbar:!0},{name:\"alignRight\",label:\"Align Right\",category:\"alignment\",type:\"apply\",handler:n.alignRight,icon:\"alignRight\",toolbarGroup:\"align\",isActive:e=>e.align===\"right\",exclusiveGroup:\"alignment\",fixedToolbar:!0},{name:\"alignJustify\",label:\"Justify\",category:\"alignment\",type:\"apply\",handler:n.alignJustify,icon:\"alignJustify\",toolbarGroup:\"align\",isActive:e=>e.align===\"justify\",exclusiveGroup:\"alignment\"},{name:\"indent\",label:\"Indent\",category:\"alignment\",type:\"action\",handler:n.indent},{name:\"outdent\",label:\"Outdent\",category:\"alignment\",type:\"action\",handler:n.outdent},{name:\"insertHR\",label:\"Horizontal Rule\",category:\"insert\",type:\"action\",handler:n.insertHR},{name:\"insertHTML\",label:\"Insert HTML\",category:\"insert\",type:\"action\",handler:n.insertHTML},{name:\"insertText\",label:\"Insert Text\",category:\"insert\",type:\"action\",handler:n.insertText},{name:\"setFontSize\",label:\"Font Size\",category:\"styling\",type:\"apply\",handler:n.setFontSize,getAttributes:e=>e.fontSize?{size:e.fontSize}:void 0},{name:\"setFontFamily\",label:\"Font Family\",category:\"styling\",type:\"apply\",handler:n.setFontFamily,getAttributes:e=>e.fontFamily?{family:e.fontFamily}:void 0},{name:\"setColor\",label:\"Text Color\",category:\"styling\",type:\"apply\",handler:n.setColor,getAttributes:e=>e.color?{color:e.color}:void 0},{name:\"setBackgroundColor\",label:\"Background Color\",category:\"styling\",type:\"apply\",handler:n.setBackgroundColor,getAttributes:e=>e.backgroundColor?{color:e.backgroundColor}:void 0}]}function I(n){let e=typeof n.target==\"string\"?document.querySelector(n.target):n.target;if(!e)throw new Error(\"Scribe: Target element not found\");let t=n.iframe?.contentDocument||e.ownerDocument;if(!t)throw new Error(\"Scribe: Could not access document\");let o=new S(t,e),i=new v(n.sanitize),a=new k,d=new x(e),s=new L,g=!1,h=n.readOnly??!1,C=null,p=new Map,y=new Map,E=[...H],T=new Map,c=e;h||(c.contentEditable=\"true\"),c.classList.add(\"scribe-editor\",\"scribe-content\"),n.placeholder&&c.setAttribute(\"data-placeholder\",n.placeholder),Object.entries(w).forEach(([r,l])=>{y.set(r,l)}),s.registerAll(R(w));let K=(r,l)=>{if(!r)return Object.keys(l);let f=[];for(let b of Object.keys(l))r[b]!==l[b]&&f.push(b);return f},A=(r,l)=>{let f=K(C,r);if(f.length>0){let b={previous:C,current:r,changed:f,source:l};m.emit(\"formatChange\",b)}C={...r}},u=(r,...l)=>{if(h)return;let f=s.get(r),b=f?.handler||y.get(r);if(b){let M=l.length>0?l:f?.defaultArgs||[];b(m,...M),d.normalize(),a.push(c.innerHTML,null),m.emit(\"change\",c.innerHTML),n.onChange?.(c.innerHTML);let W=o.getFormats();A(W,\"command\"),requestAnimationFrame(()=>{let D=o.getSelection();m.emit(\"selectionChange\",D),D&&A(D.formats,\"command\")})}},m={getDocument:()=>t,getContentElement:()=>c,getSelection:()=>o.getSelection(),getFormatState:()=>{let r=o.getSelection();return r?r.formats:o.getFormats()},getCommandState:r=>{let l=m.getFormatState(),f=o.getSelection(),b=f?!f.collapsed:!1;return s.getCommandState(r,l,b,h)},getAllCommandStates:()=>{let r=m.getFormatState(),l=o.getSelection(),f=l?!l.collapsed:!1;return s.getAllCommandStates(r,f,h)},exec:(r,...l)=>u(r,...l),canExec:r=>!!m.getCommandState(r)?.enabled,bold:()=>u(\"bold\"),italic:()=>u(\"italic\"),underline:()=>u(\"underline\"),strike:()=>u(\"strike\"),code:()=>u(\"code\"),subscript:()=>u(\"subscript\"),superscript:()=>u(\"superscript\"),clearFormat:()=>u(\"clearFormat\"),heading:r=>u(\"heading\",r),paragraph:()=>u(\"paragraph\"),blockquote:()=>u(\"blockquote\"),codeBlock:()=>u(\"codeBlock\"),orderedList:()=>u(\"orderedList\"),unorderedList:()=>u(\"unorderedList\"),alignLeft:()=>u(\"alignLeft\"),alignCenter:()=>u(\"alignCenter\"),alignRight:()=>u(\"alignRight\"),alignJustify:()=>u(\"alignJustify\"),indent:()=>u(\"indent\"),outdent:()=>u(\"outdent\"),link:r=>u(\"link\",r),unlink:()=>u(\"unlink\"),insertHR:()=>u(\"insertHR\"),insertHTML:r=>u(\"insertHTML\",r),insertText:r=>u(\"insertText\",r),setFontSize:r=>u(\"setFontSize\",r),setFontFamily:r=>u(\"setFontFamily\",r),setColor:r=>u(\"setColor\",r),setBackgroundColor:r=>u(\"setBackgroundColor\",r),undo:()=>m.emit(\"undo\"),redo:()=>m.emit(\"redo\"),getHTML:()=>c.innerHTML,setHTML:r=>{let l=i.sanitize(r);c.innerHTML=l,d.normalize(),a.pushImmediate(l,null),m.emit(\"change\",l)},getText:()=>c.textContent||\"\",isEmpty:()=>(c.textContent?.trim()||\"\")===\"\"&&c.children.length<=1,saveSelection:r=>o.saveSelection(r||\"manual\"),restoreSelection:()=>{let r=o.restoreSelection();if(r){let l=o.getSelection();m.emit(\"selectionChange\",l),l&&A(l.formats,\"selection\")}return r},focus:()=>{c.focus(),m.restoreSelection(),m.emit(\"focus\")},blur:()=>c.blur(),normalize:()=>d.normalize(),getPlugin:r=>p.get(r),isReadOnly:()=>h,setReadOnly:r=>{h=r,c.contentEditable=r?\"false\":\"true\",m.emit(\"readOnlyChange\",r)},on:(r,l)=>{T.has(r)||T.set(r,new Set),T.get(r).add(l)},off:(r,l)=>{T.get(r)?.delete(l)},emit:(r,...l)=>{T.get(r)?.forEach(f=>f(...l))},destroy:()=>{g||(g=!0,p.forEach(r=>r.destroy?.()),p.clear(),c.removeEventListener(\"input\",B),c.removeEventListener(\"keydown\",P),c.removeEventListener(\"keyup\",_),c.removeEventListener(\"mouseup\",q),c.removeEventListener(\"paste\",O),c.removeEventListener(\"focus\",z),c.removeEventListener(\"blur\",G),t.removeEventListener(\"selectionchange\",N),c.contentEditable=\"false\",c.classList.remove(\"scribe-editor\",\"scribe-content\"),c.removeAttribute(\"data-placeholder\"),T.clear(),a.clear(),m.emit(\"destroy\"))}},B=()=>{h||(a.push(c.innerHTML,null),m.emit(\"change\",c.innerHTML),n.onChange?.(c.innerHTML))},P=r=>{if(!h)for(let l of E){let f=l.ctrl?r.ctrlKey||r.metaKey:!(r.ctrlKey||r.metaKey),b=l.shift?r.shiftKey:!r.shiftKey,M=l.alt?r.altKey:!r.altKey;if(r.key.toLowerCase()===l.key.toLowerCase()&&f&&b&&M){r.preventDefault(),u(l.command,...l.args||[]);return}}},O=r=>{if(h)return;r.preventDefault();let l=r.clipboardData?.getData(\"text/html\"),f=r.clipboardData?.getData(\"text/plain\");if(l){let b=i.sanitizePaste(l);u(\"insertHTML\",b)}else f&&u(\"insertText\",f)},z=()=>{m.emit(\"focus\"),n.onFocus?.()},G=()=>{m.emit(\"blur\"),n.onBlur?.()},F=null,N=()=>{F&&cancelAnimationFrame(F),F=requestAnimationFrame(()=>{if(g)return;if(!o.isSelectionInContent()){m.emit(\"selectionChange\",null);return}let l=o.getSelection();m.emit(\"selectionChange\",l),n.onSelectionChange?.(l);let f=l?l.formats:o.getFormats();A(f,\"selection\")})},q=()=>{setTimeout(N,10)},_=r=>{([\"ArrowLeft\",\"ArrowRight\",\"ArrowUp\",\"ArrowDown\",\"Home\",\"End\",\"PageUp\",\"PageDown\"].includes(r.key)||r.key.length===1)&&N()};return m.on(\"undo\",()=>{let r=a.undo();r&&(c.innerHTML=r.html,m.emit(\"change\",r.html))}),m.on(\"redo\",()=>{let r=a.redo();r&&(c.innerHTML=r.html,m.emit(\"change\",r.html))}),c.addEventListener(\"input\",B),c.addEventListener(\"keydown\",P),c.addEventListener(\"keyup\",_),c.addEventListener(\"mouseup\",q),c.addEventListener(\"paste\",O),c.addEventListener(\"focus\",z),c.addEventListener(\"blur\",G),t.addEventListener(\"selectionchange\",N),n.plugins?.forEach(r=>{p.set(r.name,r),r.commands&&Object.entries(r.commands).forEach(([l,f])=>{y.set(l,f)}),r.shortcuts&&E.push(...r.shortcuts),r.init?.(m)}),a.pushImmediate(c.innerHTML,null),n.autofocus&&setTimeout(()=>m.focus(),0),m.emit(\"ready\"),m}function j(n,e={}){let t=document.querySelector(n);if(!t)throw new Error(`Scribe: Element \"${n}\" not found`);return I({target:t,mode:\"inline\",...e})}var V={init:j,createEditor:I};var Y={name:\"bold\",toolbarItems:[{name:\"bold\",icon:\"bold\",title:\"Bold (Ctrl+B)\",command:\"bold\",isActive:n=>n.bold,group:\"format\"}]},Q={name:\"italic\",toolbarItems:[{name:\"italic\",icon:\"italic\",title:\"Italic (Ctrl+I)\",command:\"italic\",isActive:n=>n.italic,group:\"format\"}]},ee={name:\"underline\",toolbarItems:[{name:\"underline\",icon:\"underline\",title:\"Underline (Ctrl+U)\",command:\"underline\",isActive:n=>n.underline,group:\"format\"}]},te={name:\"strike\",toolbarItems:[{name:\"strike\",icon:\"strikethrough\",title:\"Strikethrough\",command:\"strike\",isActive:n=>n.strike,group:\"format\"}]},ne={name:\"code\",toolbarItems:[{name:\"code\",icon:\"code\",title:\"Inline Code\",command:\"code\",isActive:n=>n.code,group:\"format\"}]},oe={name:\"heading\",toolbarItems:[{name:\"h1\",icon:\"heading1\",title:\"Heading 1\",command:\"heading\",args:[1],isActive:n=>n.heading===1,group:\"block\"},{name:\"h2\",icon:\"heading2\",title:\"Heading 2\",command:\"heading\",args:[2],isActive:n=>n.heading===2,group:\"block\"},{name:\"h3\",icon:\"heading3\",title:\"Heading 3\",command:\"heading\",args:[3],isActive:n=>n.heading===3,group:\"block\"}]},ie={name:\"list\",toolbarItems:[{name:\"unorderedList\",icon:\"list\",title:\"Bullet List\",command:\"unorderedList\",isActive:n=>n.list===\"unordered\",group:\"list\"},{name:\"orderedList\",icon:\"listOrdered\",title:\"Numbered List\",command:\"orderedList\",isActive:n=>n.list===\"ordered\",group:\"list\"}]},re={name:\"blockquote\",toolbarItems:[{name:\"blockquote\",icon:\"quote\",title:\"Quote\",command:\"blockquote\",isActive:n=>n.blockquote,group:\"block\"}]},ae={name:\"link\",toolbarItems:[{name:\"link\",icon:\"link\",title:\"Link (Ctrl+K)\",command:\"showLinkModal\",isActive:n=>!!n.link,group:\"insert\"}]},le={name:\"alignment\",toolbarItems:[{name:\"alignLeft\",icon:\"alignLeft\",title:\"Align Left\",command:\"alignLeft\",isActive:n=>n.align===\"left\",group:\"align\"},{name:\"alignCenter\",icon:\"alignCenter\",title:\"Align Center\",command:\"alignCenter\",isActive:n=>n.align===\"center\",group:\"align\"},{name:\"alignRight\",icon:\"alignRight\",title:\"Align Right\",command:\"alignRight\",isActive:n=>n.align===\"right\",group:\"align\"}]},se={name:\"clearFormat\",toolbarItems:[{name:\"clearFormat\",icon:\"removeFormatting\",title:\"Clear Formatting (Ctrl+\\\\)\",command:\"clearFormat\",group:\"misc\"}]},ce={name:\"history\",toolbarItems:[{name:\"undo\",icon:\"undo\",title:\"Undo (Ctrl+Z)\",command:\"undo\",group:\"history\"},{name:\"redo\",icon:\"redo\",title:\"Redo (Ctrl+Shift+Z)\",command:\"redo\",group:\"history\"}]},de=[Y,Q,ee,te,ne,oe,ie,re,ae,le,se,ce];export{L as CommandRegistry,x as DOMNormalizer,v as HTMLSanitizer,k as HistoryManager,V as Scribe,S as SelectionManager,w as coreCommands,R as createDefaultRegistrations,I as createEditor,de as defaultPlugins,H as defaultShortcuts,j as init};\n","/**\n * Manages ScribeJS editor instances  create, cache, destroy.\n */\n\nimport { Scribe } from 'scribejs-editor';\nimport type { EditorConfig as ScribeConfig, EditorInstance as ScribeInstance, Plugin as ScribePlugin } from 'scribejs-editor';\nimport type { ManagedInstance, ScribePluginOptions } from './types';\n\nlet counter = 0;\n\nexport class InstanceManager {\n  private instances = new Map<string, ManagedInstance>();\n  private options: ScribePluginOptions;\n  private extraPlugins: ScribePlugin[] = [];\n\n  constructor(options: ScribePluginOptions) {\n    this.options = options;\n    if (options.plugins) {\n      this.extraPlugins.push(...options.plugins);\n    }\n  }\n\n  /** Register an additional ScribeJS plugin for all future instances */\n  registerPlugin(plugin: ScribePlugin) {\n    this.extraPlugins.push(plugin);\n  }\n\n  /** Create a new ScribeJS instance on an element */\n  create(\n    el: HTMLElement,\n    overrides: Partial<ScribeConfig> = {},\n    callbacks?: {\n      onChange?: (html: string) => void;\n      onFocus?: () => void;\n      onBlur?: () => void;\n      onSelectionChange?: (sel: unknown) => void;\n    },\n  ): ScribeInstance {\n    // Re-use existing\n    const existing = this.getByElement(el);\n    if (existing) return existing;\n\n    const id = `scribe-gjs-${++counter}`;\n    el.dataset.scribeId = id;\n\n    const config: Partial<ScribeConfig> = {\n      ...this.options.scribeConfig,\n      ...overrides,\n      plugins: [...(this.options.scribeConfig?.plugins ?? []), ...this.extraPlugins],\n      onChange: (html: string) => {\n        callbacks?.onChange?.(html);\n        this.options.scribeConfig?.onChange?.(html);\n      },\n      onFocus: () => {\n        callbacks?.onFocus?.();\n        this.options.scribeConfig?.onFocus?.();\n      },\n      onBlur: () => {\n        callbacks?.onBlur?.();\n        this.options.scribeConfig?.onBlur?.();\n      },\n      onSelectionChange: (sel) => {\n        if (this.options.debug) {\n          console.log('[ScribeJS Debug] Selection changed:', sel);\n        }\n        callbacks?.onSelectionChange?.(sel);\n        this.options.scribeConfig?.onSelectionChange?.(sel as any);\n      },\n    };\n\n    const scribe = Scribe.createEditor({\n      target: el,\n      ...config,\n    } as ScribeConfig);\n\n    const cleanup = () => {\n      scribe.destroy();\n      this.instances.delete(id);\n      delete el.dataset.scribeId;\n    };\n\n    this.instances.set(id, { id, element: el, scribe, cleanup });\n\n    if (this.options.debug) {\n      console.log(`[ScribeJS Plugin] Created instance ${id}`);\n    }\n\n    return scribe;\n  }\n\n  /** Destroy instance by element */\n  destroyByElement(el: HTMLElement) {\n    const id = el.dataset.scribeId;\n    if (!id) return;\n    const inst = this.instances.get(id);\n    inst?.cleanup();\n  }\n\n  /** Get instance by element */\n  getByElement(el: HTMLElement): ScribeInstance | undefined {\n    const id = el.dataset.scribeId;\n    if (!id) return undefined;\n    return this.instances.get(id)?.scribe;\n  }\n\n  /** Destroy all instances */\n  destroyAll() {\n    this.instances.forEach((inst) => inst.cleanup());\n    this.instances.clear();\n  }\n\n  /** Expose the map */\n  getAll(): Map<string, ManagedInstance> {\n    return this.instances;\n  }\n\n  get size(): number {\n    return this.instances.size;\n  }\n}\n","/**\n * Toolbar management for grapesjs-plugin-scribejs\n */\n\nimport type { FormatState, ToolbarOptions } from './types';\n\n/* ---- Toolbar Item Definitions ---- */\n\nexport type ToolbarItemType = 'button' | 'select' | 'color-picker';\n\nexport interface ToolbarSelectOption {\n  label: string;\n  value: string;\n  style?: string; // e.g. font-family preview\n}\n\nexport interface ToolbarItemDef {\n  type: ToolbarItemType;\n  name: string;\n  label?: string; // accessible label or tooltip\n  icon?: string; // only for buttons\n  command?: string; // only for buttons\n  options?: ToolbarSelectOption[]; // only for select\n  colors?: string[]; // only for color-picker\n  isActive?: (f: FormatState) => boolean; // for button state\n  getValue?: (f: FormatState) => string; // for select value\n  group?: string;\n}\n\nconst DEFAULT_FONTS = [\n  'Arial, sans-serif',\n  'Helvetica, sans-serif',\n  'Times New Roman, serif',\n  'Courier New, monospace',\n  'Verdana, sans-serif',\n  'Georgia, serif',\n  'Palatino, serif',\n  'Garamond, serif',\n  'Bookman, serif',\n  'Comic Sans MS, cursive'\n].map(f => (typeof f === 'string' ? { label: f.split(',')[0], value: f, style: `font-family: ${f}` } : f));\n\n\n\n\nconst DEFAULT_COLORS = [\n  '#000000', '#434343', '#666666', '#999999', '#B7B7B7', '#CCCCCC', '#D9D9D9', '#EFEFEF', '#F3F3F3', '#FFFFFF',\n  '#980000', '#FF0000', '#FF9900', '#FFFF00', '#00FF00', '#00FFFF', '#4A86E8', '#0000FF', '#9900FF', '#FF00FF',\n  '#E6B8AF', '#F4CCCC', '#FCE5CD', '#FFF2CC', '#D9EAD3', '#D0E0E3', '#C9DAF8', '#CFE2F3', '#D9D2E9', '#EAD1DC',\n  '#DD7E6B', '#EA9999', '#F9CB9C', '#FFE599', '#B6D7A8', '#A2C4C9', '#A4C2F4', '#9FC5E8', '#B4A7D6', '#D5A6BD',\n  '#CC4125', '#E06666', '#F6B26B', '#FFD966', '#93C47D', '#76A5AF', '#6D9EEB', '#6FA8DC', '#8E7CC3', '#C27BA0',\n  '#A61C00', '#CC0000', '#E69138', '#F1C232', '#6AA84F', '#45818E', '#3C78D8', '#3D85C6', '#674EA7', '#A64D79'\n];\n\nconst DEFAULT_ITEMS: ToolbarItemDef[] = [\n  // Block Formatting (Select)\n  {\n    type: 'select',\n    name: 'formatBlock',\n    label: 'Text Style',\n    group: 'block',\n    options: [\n      { label: 'Paragraph', value: 'p' },\n      { label: 'Heading 1', value: 'h1' },\n      { label: 'Heading 2', value: 'h2' },\n      { label: 'Heading 3', value: 'h3' },\n      { label: 'Heading 4', value: 'h4' },\n      { label: 'Heading 5', value: 'h5' },\n      { label: 'Heading 6', value: 'h6' },\n      { label: 'Quote', value: 'blockquote' },\n    ],\n    getValue: (f) => {\n      if (f.heading) return `h${f.heading}`;\n      if (f.blockquote) return 'blockquote';\n      return 'p';\n    },\n  },\n\n  // Font\n  {\n    type: 'select',\n    name: 'fontFamily',\n    label: 'Font Family', // Placeholder text\n    group: 'font',\n    options: DEFAULT_FONTS,\n    getValue: (f) => f.fontFamily || ''\n  },\n\n  // Inline Formatting\n  {\n    type: 'button',\n    name: 'bold',\n    label: 'Bold',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8\"/></svg>',\n    command: 'bold',\n    isActive: (f) => f.bold,\n    group: 'inline',\n  },\n  {\n    type: 'button',\n    name: 'italic',\n    label: 'Italic',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><line x1=\"19\" y1=\"4\" x2=\"10\" y2=\"4\"/><line x1=\"14\" y1=\"20\" x2=\"5\" y2=\"20\"/><line x1=\"15\" y1=\"4\" x2=\"9\" y2=\"20\"/></svg>',\n    command: 'italic',\n    isActive: (f) => f.italic,\n    group: 'inline',\n  },\n  {\n    type: 'button',\n    name: 'underline',\n    label: 'Underline',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M6 4v6a6 6 0 0 0 12 0V4\"/><line x1=\"4\" y1=\"20\" x2=\"20\" y2=\"20\"/></svg>',\n    command: 'underline',\n    isActive: (f) => f.underline,\n    group: 'inline',\n  },\n  {\n    type: 'button',\n    name: 'strike',\n    label: 'Strike',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M16 4H9a3 3 0 0 0-2.83 4\"/><path d=\"M14 12a4 4 0 0 1 0 8H6\"/><line x1=\"4\" y1=\"12\" x2=\"20\" y2=\"12\"/></svg>',\n    command: 'strike',\n    isActive: (f) => f.strike,\n    group: 'inline',\n  },\n  {\n    type: 'color-picker',\n    name: 'color',\n    label: 'Text Color',\n    icon: `<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n      <path d=\"M4 20h16\"/>\n      <path d=\"m6 16 6-11 6 11\"/>\n      <path d=\"M8 12h8\"/>\n      <path class=\"color-indicator\" d=\"M4 21h16\" stroke-width=\"3\" style=\"stroke: currentColor;\"/>\n    </svg>`,\n    command: 'setColor',\n    colors: DEFAULT_COLORS,\n    getValue: (f) => f.color || '',\n    group: 'color',\n  },\n  {\n    type: 'color-picker',\n    name: 'backgroundColor',\n    label: 'Highlight Color',\n    icon: `<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n      <path d=\"m9 11-6 6v3h9l3-3\"/>\n      <path d=\"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4\"/>\n      <path class=\"color-indicator\" d=\"M4 21h16\" stroke-width=\"3\" style=\"stroke: transparent;\"/>\n    </svg>`,\n    command: 'setBackgroundColor',\n    colors: DEFAULT_COLORS,\n    getValue: (f) => f.backgroundColor || '',\n    group: 'color',\n  },\n  {\n    type: 'button',\n    name: 'clearFormat',\n    label: 'Clear Formatting',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M8 5h11a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-1\"/><path d=\"M11 5v14\"/><path d=\"M7 19h8\"/><line x1=\"2\" y1=\"2\" x2=\"22\" y2=\"22\"/></svg>',\n    command: 'clearFormat',\n    group: 'inline',\n  },\n\n  // Link\n  {\n    type: 'button',\n    name: 'link',\n    label: 'Link',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"/><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"/></svg>',\n    command: 'link',\n    isActive: (f) => f.link !== null,\n    group: 'link',\n  },\n\n  // Alignment\n  {\n    type: 'button',\n    name: 'alignLeft',\n    label: 'Align Left',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/><line x1=\"15\" y1=\"12\" x2=\"3\" y2=\"12\"/><line x1=\"17\" y1=\"18\" x2=\"3\" y2=\"18\"/></svg>',\n    command: 'alignLeft',\n    isActive: (f) => f.align === 'left',\n    group: 'align',\n  },\n  {\n    type: 'button',\n    name: 'alignCenter',\n    label: 'Align Center',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/><line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"/><line x1=\"21\" y1=\"18\" x2=\"3\" y2=\"18\"/></svg>',\n    command: 'alignCenter',\n    isActive: (f) => f.align === 'center',\n    group: 'align',\n  },\n  {\n    type: 'button',\n    name: 'alignRight',\n    label: 'Align Right',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"/><line x1=\"21\" y1=\"18\" x2=\"7\" y2=\"18\"/></svg>',\n    command: 'alignRight',\n    isActive: (f) => f.align === 'right',\n    group: 'align',\n  },\n  {\n    type: 'button',\n    name: 'alignJustify',\n    label: 'Justify',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"/><line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"/><line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"/></svg>',\n    command: 'alignJustify',\n    isActive: (f) => f.align === 'justify',\n    group: 'align',\n  },\n\n  // List\n  {\n    type: 'button',\n    name: 'unorderedList',\n    label: 'Bullet list',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M3 12h.01\"/><path d=\"M3 18h.01\"/><path d=\"M3 6h.01\"/><path d=\"M8 12h13\"/><path d=\"M8 18h13\"/><path d=\"M8 6h13\"/></svg>',\n    command: 'unorderedList',\n    isActive: (f) => f.list === 'unordered',\n    group: 'list',\n  },\n  {\n    type: 'button',\n    name: 'orderedList',\n    label: 'Numbered list',\n    icon: '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M10 12h11\"/><path d=\"M10 18h11\"/><path d=\"M10 6h11\"/><path d=\"M4 10h2\"/><path d=\"M4 6h1v4\"/><path d=\"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1\"/></svg>',\n    command: 'orderedList',\n    isActive: (f) => f.list === 'ordered',\n    group: 'list',\n  },\n];\n\n/* ---- Toolbar Manager ---- */\n\nexport class ToolbarManager {\n  private toolbarEl: HTMLElement | null = null;\n  private items: Map<string, HTMLElement> = new Map();\n  private opts: ToolbarOptions;\n  // Track open popovers\n  private activePopover: HTMLElement | null = null;\n  // Track the currently active command executor\n  private currentExecutor: ((command: string, ...args: unknown[]) => void) | null = null;\n  // Track if event listeners have been bound\n  private listenersAttached = false;\n\n  constructor(opts: ToolbarOptions = {}) {\n    this.opts = {\n      flex: true,\n      wrap: true,\n      responsive: true,\n      ...opts,\n    };\n  }\n\n  get element(): HTMLElement | null {\n    return this.toolbarEl;\n  }\n\n  /** Build the toolbar DOM and return it */\n  create(doc: Document = document): HTMLElement {\n    const toolbar = doc.createElement('div');\n    toolbar.className = 'scribe-gjs-toolbar';\n    toolbar.setAttribute('role', 'toolbar');\n    toolbar.setAttribute('aria-label', 'Text formatting');\n\n    this.applyBaseStyles(toolbar);\n\n    // Build buttons\n    const itemNames = this.getItemNames();\n    let lastGroup: string | undefined;\n\n    for (const item of DEFAULT_ITEMS) {\n      if (itemNames && !itemNames.includes(item.name)) continue;\n\n      // Group separators\n      if (lastGroup && item.group && item.group !== lastGroup) {\n        const sep = doc.createElement('span');\n        sep.className = 'scribe-gjs-sep';\n        sep.setAttribute('aria-hidden', 'true');\n        toolbar.appendChild(sep);\n      }\n\n      const el = this.createItem(doc, item);\n\n      // Prevent stealing focus from editor\n      el.addEventListener('mousedown', (e) => {\n        // Allow interactions with our custom popovers\n\n        // If it's a regular button (not opening a popover), we want to prevent default\n        // But for our custom select & color picker triggers, we also want to prevent default\n        // to keep focus on editor, UNLESS we are clicking inside an input in a modal.\n        // Since we are clicking the toolbar buttons themselves:\n        e.preventDefault();\n        // We do NOT stop propagation here usually, unless needed.\n      });\n\n      toolbar.appendChild(el);\n      this.items.set(item.name, el);\n\n      lastGroup = item.group ?? lastGroup;\n    }\n\n    this.toolbarEl = toolbar;\n\n    // Global click listener to close popovers\n    doc.addEventListener('click', (e) => {\n      // If click is outside active popover and outside the toolbar element that opened it\n      // actually we can just check if it's clicking inside the popover.\n      if (this.activePopover && !this.activePopover.contains(e.target as Node)) {\n        // Check if we clicked the toggle button for this popover?\n        // The toggle logic usually handles the 'inside button' case by toggling.\n        // But if we clicked 'blocks' or elsewhere, close it.\n        this.closePopover();\n      }\n    });\n\n    return toolbar;\n  }\n\n  private createItem(doc: Document, item: ToolbarItemDef): HTMLElement {\n    if (item.type === 'select') {\n      // CUSTOM SELECT IMPLEMENTATION\n      const wrapper = doc.createElement('div');\n      wrapper.className = 'scribe-gjs-select-wrapper';\n\n      const btn = doc.createElement('button');\n      btn.type = 'button';\n      btn.className = 'scribe-gjs-select-btn';\n      // Initial label\n      const activeLabel = item.options?.find(o => o.value === '')?.label || item.label || item.name;\n      btn.innerHTML = `<span class=\"label\">${activeLabel}</span><svg width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M6 9l6 6 6-6\"/></svg>`;\n\n      btn.addEventListener('click', (e) => {\n        e.stopPropagation(); // prevent global close\n        this.toggleSelect(doc, wrapper, item);\n      });\n\n      wrapper.appendChild(btn);\n      return wrapper;\n\n    } else if (item.type === 'color-picker') {\n      const wrapper = doc.createElement('div');\n      wrapper.className = 'scribe-gjs-color-wrapper';\n\n      const btn = doc.createElement('button');\n      btn.type = 'button';\n      btn.className = 'scribe-gjs-btn';\n      if (item.label) btn.setAttribute('aria-label', item.label);\n\n      if (item.icon) btn.innerHTML = item.icon;\n\n      btn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        this.toggleColorPicker(doc, wrapper, item);\n      });\n\n      wrapper.appendChild(btn);\n      return wrapper;\n\n    } else {\n      const btn = doc.createElement('button');\n      btn.type = 'button';\n      btn.className = 'scribe-gjs-btn';\n      if (item.command) btn.dataset.command = item.command;\n      btn.dataset.name = item.name;\n      if (item.label) {\n        btn.title = item.label;\n        btn.setAttribute('aria-label', item.label);\n      }\n      btn.setAttribute('aria-pressed', 'false');\n      if (item.icon && item.icon.trim().startsWith('<')) {\n        btn.innerHTML = item.icon;\n      } else if (item.icon) {\n        btn.textContent = item.icon;\n      }\n      return btn;\n    }\n  }\n\n  private toggleSelect(doc: Document, wrapper: HTMLElement, item: ToolbarItemDef) {\n    if (this.activePopover && this.activePopover.parentElement === wrapper) {\n      this.closePopover();\n      return;\n    }\n    this.closePopover();\n\n    const dropdown = doc.createElement('div');\n    dropdown.className = 'scribe-gjs-select-dropdown';\n    // Position roughly\n\n    item.options?.forEach(opt => {\n      if (opt.value === '') return; // skip placeholder in list if desired, or keep it.\n      // Let's skip placeholder in the dropdown list for cleaner UI? \n      // Or keep it as \"Default\"? The user didn't specify. \n      // User asked for \"placeholder for select input... if font family was selected then show it\".\n      // In dropdown list usually we show options.\n\n      const optBtn = doc.createElement('button');\n      optBtn.type = 'button';\n      optBtn.className = 'scribe-gjs-select-option';\n      optBtn.textContent = opt.label;\n      if (opt.style) optBtn.style.cssText = opt.style;\n\n      optBtn.addEventListener('mousedown', (e) => {\n        e.preventDefault(); // Prevent focus loss!\n      });\n\n      optBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        // Dispatch change\n        const event = new CustomEvent('select-changed', { detail: { value: opt.value, name: item.name } });\n        wrapper.dispatchEvent(event);\n        this.closePopover();\n      });\n\n      // Mark active option\n      const currentVal = item.getValue ? item.getValue(this.lastFormats || {}) : '';\n      const normalize = (f: string) => f.toLowerCase().replace(/['\"]/g, '').split(',')[0].trim();\n      if (normalize(opt.value) === normalize(currentVal)) {\n        optBtn.classList.add('active');\n        // Scroll into view when opened (need to wait for append)\n        setTimeout(() => optBtn.scrollIntoView({ block: 'nearest' }), 0);\n      }\n\n      dropdown.appendChild(optBtn);\n    });\n\n    wrapper.appendChild(dropdown);\n    this.activePopover = dropdown;\n  }\n\n  private toggleColorPicker(doc: Document, wrapper: HTMLElement, item: ToolbarItemDef) {\n    if (this.activePopover && this.activePopover.parentElement === wrapper) {\n      this.closePopover();\n      return;\n    }\n    this.closePopover();\n\n    const picker = doc.createElement('div');\n    picker.className = 'scribe-gjs-color-picker';\n\n    // Default (Reset) Action\n    const resetBtn = doc.createElement('div');\n    resetBtn.className = 'scribe-gjs-color-reset';\n    resetBtn.textContent = 'Default';\n\n    resetBtn.addEventListener('mousedown', (e) => e.preventDefault()); // Keep focus\n    resetBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const event = new CustomEvent('color-selected', { detail: { color: 'initial', command: item.command } });\n      wrapper.dispatchEvent(event);\n      this.closePopover();\n    });\n    picker.appendChild(resetBtn);\n\n    const grid = doc.createElement('div');\n    grid.className = 'scribe-gjs-color-grid';\n\n    item.colors?.forEach(color => {\n      const swatch = doc.createElement('button');\n      swatch.type = 'button';\n      swatch.className = 'scribe-gjs-color-swatch';\n      swatch.style.backgroundColor = color;\n      swatch.dataset.color = color;\n\n      swatch.addEventListener('mousedown', (e) => e.preventDefault()); // Keep focus\n      swatch.addEventListener('click', (e) => {\n        e.stopPropagation();\n        const event = new CustomEvent('color-selected', { detail: { color, command: item.command } });\n        wrapper.dispatchEvent(event);\n        this.closePopover();\n      });\n\n      grid.appendChild(swatch);\n    });\n\n    picker.appendChild(grid);\n    wrapper.appendChild(picker);\n    this.activePopover = picker;\n  }\n\n  private closePopover() {\n    if (this.activePopover) {\n      this.activePopover.remove();\n      this.activePopover = null;\n    }\n  }\n\n  /** Attach handlers that call scribe commands */\n  bindCommands(execFn: (command: string, ...args: unknown[]) => void) {\n    // Update the current executor\n    this.currentExecutor = execFn;\n\n    // Only attach event listeners once\n    if (this.listenersAttached) return;\n    this.listenersAttached = true;\n\n    this.items.forEach((el, name) => {\n      const item = DEFAULT_ITEMS.find((b) => b.name === name);\n      if (!item) return;\n\n      if (item.type === 'select') {\n        el.addEventListener('select-changed', (e: Event) => {\n          if (!this.currentExecutor) return;\n          const detail = (e as CustomEvent).detail;\n          if (!detail || !detail.value) return;\n          const val = detail.value;\n\n          if (name === 'formatBlock') {\n            if (val === 'p') this.currentExecutor('paragraph');\n            else if (val === 'blockquote') this.currentExecutor('blockquote');\n            else if (val.startsWith('h')) {\n              const level = parseInt(val.substring(1));\n              this.currentExecutor('heading', level);\n            }\n          } else if (name === 'fontFamily') {\n            this.currentExecutor('setFontFamily', val);\n          }\n        });\n\n      } else if (item.type === 'color-picker') {\n        el.addEventListener('color-selected', (e: Event) => {\n          if (!this.currentExecutor) return;\n          const detail = (e as CustomEvent).detail;\n          if (detail && detail.command) {\n            let color = detail.color;\n            if (color === 'initial') color = 'inherit';\n            this.currentExecutor(detail.command, color);\n          }\n        });\n\n      } else {\n        el.addEventListener('click', () => {\n          if (!this.currentExecutor || !item.command) return;\n\n          if (item.command === 'link') {\n            const modal = document.querySelector('.link-modal') as HTMLElement;\n            const backdrop = document.querySelector('.link-modal-backdrop') as HTMLElement;\n            const input = document.getElementById('link-url-input') as HTMLInputElement;\n            const removeBtn = document.getElementById('link-remove') as HTMLButtonElement;\n            const form = document.getElementById('link-form') as HTMLFormElement;\n\n            if (modal && backdrop && input && form) {\n              const rect = el.getBoundingClientRect();\n              modal.style.left = `${rect.left}px`;\n              modal.style.top = `${rect.bottom + 8}px`;\n\n              modal.classList.add('visible');\n              backdrop.classList.add('visible');\n              input.value = '';\n              input.focus();\n\n              const close = () => {\n                modal.classList.remove('visible');\n                backdrop.classList.remove('visible');\n              };\n\n              const onSubmit = (e: Event) => {\n                e.preventDefault();\n                const url = input.value;\n                if (url && this.currentExecutor) this.currentExecutor('link', url);\n                close();\n                form.removeEventListener('submit', onSubmit);\n              };\n              form.addEventListener('submit', onSubmit, { once: true });\n\n              const onRemove = () => {\n                if (this.currentExecutor) this.currentExecutor('unlink');\n                close();\n                removeBtn.removeEventListener('click', onRemove);\n              };\n              if (removeBtn) removeBtn.addEventListener('click', onRemove, { once: true });\n\n              backdrop.onclick = close;\n              document.getElementById('link-cancel')!.onclick = close;\n            } else {\n              const url = prompt('Enter URL:');\n              if (url) this.currentExecutor('link', url);\n            }\n\n          } else {\n            this.currentExecutor(item.command);\n          }\n        });\n      }\n    });\n  }\n\n  /** Update active states based on format */\n  private lastFormats: FormatState | null = null;\n  updateState(formats: FormatState | null) {\n    if (!formats) return;\n    this.lastFormats = formats;\n    this.items.forEach((el, name) => {\n      const item = DEFAULT_ITEMS.find((b) => b.name === name);\n      if (!item) return;\n\n      if (item.type === 'select' && item.getValue) {\n        const val = item.getValue(formats);\n        // Update custom select label\n        const btnLabel = el.querySelector('.scribe-gjs-select-btn .label');\n        if (btnLabel) {\n          // Improved matching for fonts and font-sizes\n          const normalize = (f: string) => f.toLowerCase().replace(/['\"]/g, '').split(',')[0].trim();\n          const normalizedVal = normalize(val);\n          const opt = item.options?.find(o => normalize(o.value) === normalizedVal);\n          btnLabel.textContent = opt ? opt.label : (val ? val.split(',')[0].replace(/['\"]/g, '') : 'Font Family');\n        }\n      } else if (item.type === 'color-picker' && item.getValue) {\n        const color = item.getValue(formats);\n        const indicator = el.querySelector('.color-indicator') as HTMLElement;\n        if (indicator) {\n          if (color && color !== 'inherit' && color !== 'initial' && color !== 'transparent') {\n            indicator.style.stroke = color;\n            indicator.style.display = 'block';\n          } else {\n            // Default colors or transparent\n            indicator.style.stroke = name === 'color' ? 'currentColor' : 'transparent';\n          }\n        }\n      } else if (item.type === 'button' && item.isActive) {\n        const active = item.isActive(formats);\n        el.classList.toggle('active', active);\n        el.setAttribute('aria-pressed', String(active));\n      }\n    });\n  }\n\n  // ... rest of class unchanged\n  /** Position the toolbar near a selection rect */\n  positionNear(rect: DOMRect, containerRect?: DOMRect) {\n    if (!this.toolbarEl) return;\n\n    const tb = this.toolbarEl;\n    const offsetY = 8;\n\n    // Default centering\n    let left = rect.left + rect.width / 2 - tb.offsetWidth / 2;\n    let top = rect.top - tb.offsetHeight - offsetY;\n\n    if (containerRect) {\n      top -= containerRect.top;\n      left -= containerRect.left;\n\n      const containerWidth = containerRect.width;\n      // Clamp horizontal\n      if (left < 4) left = 4;\n      if (left + tb.offsetWidth > containerWidth) {\n        left = containerWidth - tb.offsetWidth - 4;\n      }\n    } else {\n      // Clamp relative to viewport\n      if (left < 4) left = 4;\n      if (left + tb.offsetWidth > window.innerWidth - 4) {\n        left = window.innerWidth - tb.offsetWidth - 4;\n      }\n    }\n\n    if (top < 4) {\n      top = rect.bottom + offsetY - (containerRect?.top ?? 0);\n    }\n\n    tb.style.top = `${top}px`;\n    tb.style.left = `${left}px`;\n  }\n\n  show() {\n    this.toolbarEl?.classList.add('visible');\n  }\n\n  hide() {\n    this.toolbarEl?.classList.remove('visible');\n    this.closePopover();\n  }\n\n  destroy() {\n    this.toolbarEl?.remove();\n    this.items.clear();\n    this.toolbarEl = null;\n  }\n\n  private getItemNames(): string[] | null {\n    if (!this.opts.items || this.opts.items.length === 0) return null;\n    return this.opts.items.map((i) => (typeof i === 'string' ? i : i.name));\n  }\n\n  private applyBaseStyles(el: HTMLElement) {\n    // Force nowrap\n    el.style.display = 'flex';\n    el.style.flexWrap = 'nowrap';\n    el.style.whiteSpace = 'nowrap';\n  }\n}\n\n/* ---- Inject toolbar CSS and Modal HTML ---- */\n\nexport function injectToolbarStyles(doc: Document) {\n  if (!doc.getElementById('scribe-gjs-toolbar-styles')) {\n    const style = doc.createElement('style');\n    style.id = 'scribe-gjs-toolbar-styles';\n    style.textContent = TOOLBAR_CSS;\n    doc.head.appendChild(style);\n  }\n\n  // Inject Link Modal if missing\n  if (!doc.querySelector('.link-modal')) {\n    const backdrop = doc.createElement('div');\n    backdrop.className = 'link-modal-backdrop';\n\n    const modal = doc.createElement('div');\n    modal.className = 'link-modal';\n    modal.innerHTML = `\n        <form id=\"link-form\">\n          <div class=\"input-group\">\n            <svg viewBox=\"0 0 24 24\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\" /><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\" /></svg>\n            <input type=\"text\" id=\"link-url-input\" placeholder=\"https://...\" autocomplete=\"off\">\n          </div>\n          <div class=\"actions\">\n            <div class=\"left\">\n              <button type=\"button\" id=\"link-remove\" class=\"remove\" title=\"Remove link\">\n                <svg viewBox=\"0 0 24 24\"><path d=\"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\" /></svg>\n              </button>\n            </div>\n            <div class=\"right\">\n              <button type=\"button\" id=\"link-cancel\" class=\"cancel\">Cancel</button>\n              <button type=\"submit\" class=\"apply\">Apply</button>\n            </div>\n          </div>\n        </form>\n      `;\n    doc.body.appendChild(backdrop);\n    doc.body.appendChild(modal);\n  }\n}\n\nconst TOOLBAR_CSS = `\n.scribe-gjs-toolbar {\n  display: none;\n  position: absolute;\n  transition: top 0.12s ease, left 0.12s ease;\n  gap: 4px;\n  padding: 8px;\n  background: hsl(0 0% 100%);\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 12px;\n  box-shadow: 0 12px 32px rgba(15, 23, 42, 0.12), 0 4px 8px rgba(15, 23, 42, 0.06);\n  z-index: 99999;\n  font-family: \"Inter\", system-ui, -apple-system, sans-serif;\n  \n  white-space: nowrap;\n  flex-wrap: nowrap;\n  align-items: center;\n  flex-direction: row;\n}\n.scribe-gjs-toolbar.visible { display: flex; }\n\n.scribe-gjs-btn {\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  color: hsl(222 47% 11% / 0.8);\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.15s ease;\n  user-select: none;\n  flex-shrink: 0;\n}\n.scribe-gjs-btn:hover {\n  background: hsl(210 20% 96%);\n  color: hsl(222 47% 11%);\n  transform: translateY(-1px);\n}\n.scribe-gjs-btn.active {\n  background: hsl(215 100% 95%);\n  color: hsl(215 80% 40%);\n}\n.scribe-gjs-btn svg {\n  width: 16px;\n  height: 16px;\n  stroke: currentColor;\n  fill: none;\n  stroke-width: 2;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n}\n\n/* Custom Select */\n.scribe-gjs-select-wrapper {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  margin-right: 4px;\n  flex-shrink: 0;\n}\n.scribe-gjs-select-btn {\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  background-color: hsl(210 20% 98%);\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 6px;\n  padding: 0 8px;\n  height: 32px;\n  font-size: 13px;\n  font-family: inherit;\n  color: hsl(222 47% 11%);\n  cursor: pointer;\n  font-weight: 500;\n  min-width: 80px;\n  max-width: 140px;\n  white-space: nowrap;\n  overflow: hidden;\n  gap: 6px;\n}\n.scribe-gjs-select-btn span {\n    flex: 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n.scribe-gjs-select-btn:hover {\n  border-color: hsl(214 32% 80%);\n  background-color: hsl(210 20% 96%);\n}\n.scribe-gjs-select-dropdown {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  margin-top: 4px;\n  background: white;\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 6px;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n  padding: 4px;\n  z-index: 100;\n  min-width: 140px;\n  max-height: 240px;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n}\n.scribe-gjs-select-option {\n  all: unset;\n  display: block;\n  padding: 6px 12px;\n  font-size: 13px;\n  color: hsl(222 47% 11%);\n  cursor: pointer;\n  border-radius: 4px;\n  text-align: left;\n}\n.scribe-gjs-select-option:hover {\n  background: hsl(210 20% 96%);\n}\n.scribe-gjs-select-option.active {\n  background: hsl(215 100% 95%);\n  color: hsl(215 80% 40%);\n  font-weight: 600;\n  border-left: 3px solid hsl(215 80% 40%);\n  padding-left: 9px;\n}\n\n.scribe-gjs-sep {\n  width: 1px;\n  height: 20px;\n  background: hsl(214 32% 90%);\n  align-self: center;\n  margin: 0 4px;\n  flex-shrink: 0;\n}\n\n/* Color Picker */\n.scribe-gjs-color-wrapper {\n  position: relative;\n  display: inline-flex;\n}\n.scribe-gjs-color-picker {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  margin-top: 8px;\n  background: white;\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n  padding: 8px;\n  z-index: 100;\n  width: 190px;\n}\n.scribe-gjs-color-reset {\n  display: block;\n  width: 100%;\n  padding: 6px;\n  text-align: center;\n  font-size: 12px;\n  color: hsl(222 47% 11%);\n  background: hsl(210 20% 96%);\n  border-radius: 4px;\n  cursor: pointer;\n  margin-bottom: 6px;\n  font-weight: 500;\n}\n.scribe-gjs-color-reset:hover {\n  background: hsl(214 32% 88%);\n}\n.scribe-gjs-color-grid {\n  display: grid;\n  grid-template-columns: repeat(10, 1fr);\n  gap: 2px;\n}\n.scribe-gjs-color-swatch {\n  width: 16px;\n  height: 16px;\n  border: 1px solid rgba(0,0,0,0.1);\n  border-radius: 2px;\n  padding: 0;\n  cursor: pointer;\n}\n.scribe-gjs-color-swatch:hover {\n  transform: scale(1.2);\n  z-index: 1;\n  border-color: rgba(0,0,0,0.3);\n}\n\n/* Link Modal */\n.link-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    z-index: 99998;\n    background: rgba(0,0,0,0.1);\n    display: none;\n}\n.link-modal-backdrop.visible { display: block; }\n\n.link-modal {\n    position: fixed;\n    z-index: 99999; /* Higher than toolbar */\n    background: white;\n    border: 1px solid hsl(214 32% 88%);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.15);\n    padding: 12px;\n    min-width: 300px;\n    display: none;\n    font-family: 'Inter', sans-serif;\n}\n.link-modal.visible { display: block; }\n.link-modal input {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid hsl(214 32% 88%);\n    border-radius: 4px;\n    margin-bottom: 8px;\n    font-size: 14px;\n}\n.link-modal .actions {\n    display: flex;\n    justify-content: space-between;\n}\n.link-modal button {\n    padding: 6px 12px;\n    border-radius: 4px;\n    border: none;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 500;\n}\n.link-modal .apply {\n    background: hsl(173, 80%, 40%);\n    color: white;\n}\n.link-modal .cancel {\n    background: transparent;\n    color: #666;\n}\n.link-modal .remove {\n    background: transparent;\n    color: #ff4d4f;\n    padding: 6px;\n}\n.link-modal .input-group {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 8px;\n}\n.link-modal .input-group svg {\n    width: 16px; \n    height: 16px;\n    stroke: #999;\n    fill: none;\n    stroke-width: 2;\n}\n`;\n","/**\n * grapesjs-plugin-scribejs\n *\n * A production-ready GrapesJS plugin that replaces the built-in Rich Text\n * Editor with ScribeJS  exposing full formatting, toolbar, iframe and\n * extension APIs.\n *\n * Usage:\n *   import grapesjsScribePlugin from '@/lib/grapesjs-plugin-scribejs';\n *   const editor = grapesjs.init({\n *     plugins: [grapesjsScribePlugin],\n *     pluginsOpts: { [grapesjsScribePlugin as any]: { position: 'left' } }\n *   });\n */\n\nimport type { Editor as GrapesEditor } from 'grapesjs';\nimport type { EditorInstance as ScribeInstance, SelectionState } from 'scribejs-editor';\nimport { InstanceManager } from './instance-manager';\nimport { ToolbarManager, injectToolbarStyles } from './toolbar';\nimport type { ScribePluginOptions, ScribeExtensionAPI } from './types';\n\n// Re-export everything for external consumers\nexport * from './types';\nexport { ToolbarManager, injectToolbarStyles } from './toolbar';\nexport { InstanceManager } from './instance-manager';\n\n/**\n * Injects base styles for heading elements into the provided document head.\n * This prevents default browser margins/padding from interfering with the editor layout.\n */\nfunction injectEditorStyles(doc: Document) {\n  const styleId = 'scribe-gjs-editor-styles';\n  if (doc.getElementById(styleId)) return;\n\n  const style = doc.createElement('style');\n  style.id = styleId;\n  style.textContent = `\n    h1, h2, h3, h4, h5, h6 {\n      margin: 0 !important;\n      padding: 0 !important;\n    }\n  `;\n  doc.head.appendChild(style);\n}\n\n/* ------------------------------------------------------------------ */\n/*  Default options                                                    */\n/* ------------------------------------------------------------------ */\n\nconst DEFAULTS: ScribePluginOptions = {\n  scribeConfig: {},\n  toolbar: {},\n  iframe: undefined, // auto-detect\n  externalToolbarContainer: null,\n  outputFormat: 'json',\n  autoInit: true,\n  debug: false,\n  plugins: [],\n  features: { tables: true, media: true, code: true, collaboration: false },\n  debounceMs: 100,\n};\n\n/* ------------------------------------------------------------------ */\n/*  Plugin entry point                                                 */\n/* ------------------------------------------------------------------ */\n\nexport default function grapesjsScribePlugin(\n  editor: GrapesEditor,\n  opts: Partial<ScribePluginOptions> = {},\n) {\n  const options: ScribePluginOptions = { ...DEFAULTS, ...opts };\n  const manager = new InstanceManager(options);\n  let toolbarMgr: ToolbarManager | null = null;\n  let currentRte: ScribeInstance | null = null;\n  let externalToolbarEl: HTMLElement | null = null;\n\n  /* ---- Toolbar setup ---- */\n\n  function ensureToolbar(doc: Document): ToolbarManager {\n    if (toolbarMgr) return toolbarMgr;\n\n    toolbarMgr = new ToolbarManager(options.toolbar);\n    externalToolbarEl = resolveContainer(options.externalToolbarContainer);\n    const host = externalToolbarEl ?? editor.RichTextEditor.getToolbarEl() ?? doc.body;\n    const hostDoc = host?.ownerDocument ?? doc;\n    const el = toolbarMgr.create(hostDoc);\n\n    // Determine where to mount\n    if (externalToolbarEl) {\n      injectToolbarStyles(document);\n      externalToolbarEl.appendChild(el);\n    } else {\n      injectToolbarStyles(hostDoc);\n      host.appendChild(el);\n    }\n\n    return toolbarMgr;\n  }\n\n  function resolveContainer(target: HTMLElement | string | null | undefined): HTMLElement | null {\n    if (!target) return null;\n    if (typeof target === 'string') return document.querySelector(target);\n    return target;\n  }\n\n  /* ---- Debounce helper ---- */\n\n  function debounce<T extends (...args: any[]) => void>(fn: T, ms: number): T {\n    let timer: ReturnType<typeof setTimeout>;\n    return ((...args: any[]) => {\n      clearTimeout(timer);\n      timer = setTimeout(() => fn(...args), ms);\n    }) as unknown as T;\n  }\n\n  const updateToolbarPosition = () => setTimeout(() => editor.refresh(), 0);\n\n  /* ---- Custom RTE interface ---- */\n\n  /* ---- Custom RTE interface ---- */\n\n  editor.setCustomRte({\n    parseContent: false,\n\n    enable(el: HTMLElement, rte: ScribeInstance | undefined) {\n      const doc = el.ownerDocument;\n      let lastSelectionRange: Range | null = null;\n\n      const captureSelectionRange = () => {\n        const selection = doc.getSelection();\n        if (!selection || selection.rangeCount === 0) return;\n        const range = selection.getRangeAt(0);\n        const anchorNode = selection.anchorNode;\n        const focusNode = selection.focusNode;\n        if (!anchorNode || !focusNode) return;\n        if (!el.contains(anchorNode) || !el.contains(focusNode)) return;\n        lastSelectionRange = range.cloneRange();\n      };\n\n      const restoreSelectionRange = () => {\n        if (!lastSelectionRange) return;\n        const selection = doc.getSelection();\n        if (!selection) return;\n        // Only restore if focus was actually lost to something else\n        if (doc.activeElement !== el) {\n          selection.removeAllRanges();\n          selection.addRange(lastSelectionRange);\n        }\n      };\n\n      // Build toolbar in the same document as the GrapesJS RTE toolbar\n      const tb = ensureToolbar(doc);\n      injectEditorStyles(doc);\n\n      if (rte) {\n        // Re-use existing instance\n        currentRte = rte;\n\n        // Bind toolbar buttons to this scribe instance\n        tb.bindCommands((command: string, ...args: unknown[]) => {\n          if (!rte) return;\n\n          try {\n            const method = (rte as any)[command];\n            if (typeof method === 'function') {\n              method.apply(rte, args);\n              // After applying formatting, we want to capture the updated selection\n              // and refresh the toolbar state immediately.\n              captureSelectionRange();\n              tb.updateState(rte.getSelection()?.formats || null);\n            }\n          } finally {\n            // No longer needed\n          }\n        });\n\n        rte.focus();\n        tb.show();\n        updateToolbarPosition();\n        return rte;\n      }\n\n      // Create new ScribeJS instance\n      const scribe = manager.create(el, {}, {\n        onFocus: () => {\n          tb.show();\n          updateToolbarPosition();\n          editor.trigger('scribe:focus', { el });\n        },\n        onBlur: () => {\n          // Small delay to allow toolbar clicks\n          setTimeout(() => {\n            if (!el.contains(doc.activeElement)) {\n              // tb.hide(); // Let disable() handle cleanup\n            }\n          }, 150);\n        },\n        onSelectionChange: (sel) => {\n          const selection = sel as SelectionState | null;\n          if (selection) {\n            tb.updateState(selection.formats);\n            captureSelectionRange();\n          }\n          if (selection && selection.rect) {\n            tb.show();\n            updateToolbarPosition();\n          }\n          editor.trigger('scribe:selectionChange', { el, selection: sel as SelectionState | null });\n        },\n      });\n\n      // Bind toolbar buttons to scribe methods\n      tb.bindCommands((command: string, ...args: unknown[]) => {\n        if (!scribe) return;\n\n        try {\n          const method = (scribe as any)[command];\n          if (typeof method === 'function') {\n            method.apply(scribe, args);\n            // After applying formatting, we want to capture the updated selection\n            // and refresh the toolbar state immediately.\n            captureSelectionRange();\n            tb.updateState(scribe.getSelection()?.formats || null);\n          }\n        } finally {\n          // No longer needed\n        }\n      });\n\n      currentRte = scribe;\n      scribe.focus();\n      tb.show();\n      updateToolbarPosition();\n\n      if (options.onToolbar && externalToolbarEl) {\n        options.onToolbar(externalToolbarEl);\n      }\n\n      editor.trigger('scribe:ready', { el, instance: scribe });\n\n      if (options.debug) {\n        console.log('[ScribeJS Plugin] Enabled on element', el);\n      }\n\n      return scribe;\n    },\n\n    disable(el: HTMLElement, _rte: ScribeInstance) {\n      toolbarMgr?.hide();\n      currentRte = null;\n\n      if (options.debug) {\n        console.log('[ScribeJS Plugin] Disabled on element', el);\n      }\n    },\n\n    getContent(el: HTMLElement, rte: ScribeInstance | undefined) {\n      if (rte) return rte.getHTML();\n      return el.innerHTML;\n    },\n\n    ...options.customRte,\n  });\n\n  /* ---- Cleanup on editor destroy ---- */\n\n  editor.on('destroy', () => {\n    manager.destroyAll();\n    toolbarMgr?.destroy();\n    toolbarMgr = null;\n    currentRte = null;\n    externalToolbarEl = null;\n  });\n\n  /* ---- Toolbar positioning ---- */\n  editor.on('rteToolbarPosUpdate', (pos: any) => {\n    const { elRect, targetHeight, canvasRect } = pos;\n    const padding = 10;\n    const canvasTop = canvasRect?.top ?? 0;\n    const canvasBottom = canvasRect?.bottom ?? window.innerHeight;\n\n    // Check if there is enough space above the element\n    // We use elRect.top (viewport-relative) - canvasTop (viewport-relative) to check space within canvas\n    if ((elRect.top - canvasTop) > (targetHeight + padding + 40)) {\n      pos.top = -60;\n      pos.bottom = '';\n    } else {\n      pos.top = '';\n      pos.bottom = -6;\n    }\n\n    // Always align toolbar to the left\n    pos.left = 0;\n    pos.right = '';\n  });\n\n  // Update toolbar on scroll\n  editor.on('canvasScroll', () => {\n    updateToolbarPosition();\n  });\n\n  /* ---- Extension API ---- */\n\n  const extensionAPI: ScribeExtensionAPI = {\n    createInstance: (el, config) => manager.create(el, config),\n    destroyInstance: (el) => manager.destroyByElement(el),\n    getInstance: (el) => manager.getByElement(el),\n    destroyAll: () => manager.destroyAll(),\n    registerPlugin: (plugin) => manager.registerPlugin(plugin),\n    getInstances: () => manager.getAll(),\n  };\n\n  (editor as any).ScribeJS = extensionAPI;\n\n  if (options.debug) {\n    console.log('[ScribeJS Plugin] Initialised with options', options);\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","Object","globalThis","window","this","__webpack_require__","definition","key","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","S","constructor","e","t","savedSnapshots","isComposing","doc","contentEl","addEventListener","composing","isSelectionInContent","getSelection","rangeCount","getRangeAt","contains","commonAncestorContainer","normalizeRange","toString","i","collapsed","a","d","getClientRects","length","s","g","h","Math","min","left","C","top","p","max","right","y","bottom","DOMRect","range","cloneRange","text","rect","formats","getFormats","startContainer","nodeType","Node","TEXT_NODE","startOffset","nextSibling","setStartBefore","endContainer","endOffset","childNodes","setEndAfter","setEndBefore","ELEMENT_NODE","nodeName","getDefaultFormats","E","textContent","trim","parentElement","ownerDocument","defaultView","getComputedStyle","textDecorationLine","textDecoration","fontWeight","parseInt","bold","hasTag","italic","fontStyle","underline","includes","strike","code","subscript","superscript","link","getLinkUrl","heading","getHeadingLevel","list","getListType","blockquote","align","getAlignment","fontSize","fontFamily","color","backgroundColor","getExplicitBackground","style","tagName","toLowerCase","href","match","textAlign","mapAlign","getAttribute","saveSelection","push","timestamp","Date","now","reason","restoreSelection","pop","removeAllRanges","addRange","clearSavedSelections","snapshotCount","setSelection","selectAll","createRange","selectNodeContents","collapse","collapseToStart","collapseToEnd","getCursorPosition","getBoundingClientRect","width","height","createElement","insertNode","parentNode","removeChild","getSelectionRect","getSelectionOffsets","setEnd","start","end","J","X","img","td","th","$","Z","v","config","allowedTags","allowedAttributes","allowedSchemes","stripEmpty","sanitize","DOMParser","parseFromString","body","processNode","innerHTML","Array","from","remove","firstChild","insertBefore","getAllowedAttributes","attributes","isAttributeAllowed","name","isUrlSafe","removeAttribute","startsWith","setAttribute","sanitizeStyle","isEmpty","endsWith","slice","URL","protocol","RegExp","replace","children","sanitizePaste","k","stack","position","debounceTimer","debounceDelay","lastContent","maxSize","clearTimeout","setTimeout","addEntry","pushImmediate","html","selection","shift","undo","canUndo","redo","canRedo","getCurrent","clear","getStackSize","getPosition","x","n","INLINE_TAGS","Set","PRESERVE_EMPTY","normalize","mergeAdjacentInlines","removeEmptyNodes","flattenNestedInlines","cleanWhitespace","removeBrowserJunk","canMerge","appendChild","lastChild","has","hasChildNodes","document","createTreeWalker","NodeFilter","SHOW_TEXT","nextNode","isInsidePreformatted","repeat","test","hasAttribute","w","getDocument","execCommand","U","extractContents","clearFormat","paragraph","codeBlock","orderedList","unorderedList","alignLeft","alignCenter","alignRight","alignJustify","indent","outdent","unlink","insertHR","insertHTML","insertText","emit","setFontSize","setFontFamily","setColor","setBackgroundColor","H","ctrl","command","L","commands","Map","register","set","registerAll","forEach","getHandler","handler","getCommandState","isActive","requiresSelection","isEnabled","format","hasSelection","readOnly","getAttributes","label","category","type","active","supported","enabled","shortcut","exclusiveGroup","floatingToolbar","fixedToolbar","icon","toolbarGroup","defaultArgs","getAllCommandStates","getToolbarCommands","getNames","keys","getByCategory","getExclusiveGroup","I","target","querySelector","Error","iframe","contentDocument","T","c","contentEditable","classList","add","placeholder","entries","r","l","url","size","family","R","A","f","b","K","previous","current","changed","source","m","u","M","onChange","W","requestAnimationFrame","D","getContentElement","getFormatState","exec","canExec","getHTML","setHTML","getText","focus","blur","getPlugin","isReadOnly","setReadOnly","on","off","delete","destroy","removeEventListener","B","P","_","q","O","z","G","N","ctrlKey","metaKey","shiftKey","alt","altKey","preventDefault","args","clipboardData","getData","onFocus","onBlur","F","cancelAnimationFrame","onSelectionChange","plugins","shortcuts","init","autofocus","V","mode","createEditor","counter","InstanceManager","instances","options","extraPlugins","registerPlugin","plugin","create","el","overrides","callbacks","existing","getByElement","id","dataset","scribeId","scribeConfig","sel","debug","console","log","scribe","element","cleanup","destroyByElement","inst","destroyAll","getAll","DEFAULT_COLORS","DEFAULT_ITEMS","group","getValue","map","split","colors","ToolbarManager","toolbarEl","items","opts","activePopover","currentExecutor","listenersAttached","flex","wrap","responsive","toolbar","className","applyBaseStyles","itemNames","getItemNames","lastGroup","item","sep","createItem","closePopover","wrapper","btn","activeLabel","find","stopPropagation","toggleSelect","toggleColorPicker","title","dropdown","opt","optBtn","cssText","event","CustomEvent","detail","dispatchEvent","currentVal","lastFormats","scrollIntoView","block","picker","resetBtn","grid","swatch","bindCommands","execFn","val","level","substring","modal","backdrop","input","getElementById","removeBtn","form","close","onSubmit","once","onRemove","onclick","prompt","updateState","btnLabel","normalizedVal","indicator","stroke","display","toggle","String","positionNear","containerRect","tb","offsetY","offsetWidth","offsetHeight","containerWidth","innerWidth","show","hide","flexWrap","whiteSpace","injectToolbarStyles","TOOLBAR_CSS","head","DEFAULTS","undefined","externalToolbarContainer","outputFormat","autoInit","features","tables","media","collaboration","debounceMs","grapesjsScribePlugin","editor","manager","toolbarMgr","currentRte","externalToolbarEl","ensureToolbar","host","RichTextEditor","getToolbarEl","hostDoc","updateToolbarPosition","refresh","setCustomRte","parseContent","enable","rte","lastSelectionRange","captureSelectionRange","anchorNode","focusNode","styleId","injectEditorStyles","method","apply","trigger","activeElement","onToolbar","instance","disable","_rte","getContent","customRte","pos","elRect","targetHeight","canvasRect","canvasTop","innerHeight","extensionAPI","createInstance","destroyInstance","getInstance","getInstances","ScribeJS"],"sourceRoot":""}