/*! grapesjs-plugin-scribejs - 1.0.28 */
!function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports["grapesjs-plugin-scribejs"]=t():e["grapesjs-plugin-scribejs"]=t()}(Object('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this),()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})}},t={};e.r(t),e.d(t,{InstanceManager:()=>b,ToolbarManager:()=>x,default:()=>T,injectToolbarStyles:()=>C});var n=class{constructor(e,t){this.savedSnapshots=[],this.isComposing=!1,this.doc=e,this.contentEl=t,t.addEventListener("compositionstart",()=>{this.isComposing=!0}),t.addEventListener("compositionend",()=>{this.isComposing=!1})}get composing(){return this.isComposing}isSelectionInContent(){if(this.isComposing)return!1;let e=this.doc.getSelection();if(!e||0===e.rangeCount)return!1;let t=e.getRangeAt(0);return this.contentEl.contains(t.commonAncestorContainer)}getSelection(){if(this.isComposing)return null;let e=this.doc.getSelection();if(!e||0===e.rangeCount)return null;let t=e.getRangeAt(0);if(!this.contentEl.contains(t.commonAncestorContainer))return null;t=this.normalizeRange(t);let n=e.toString(),o=t.collapsed,i=null;if(!o){let e=t.getClientRects();if(e.length>0){let t=e[0],n=e[e.length-1],o=Math.min(t.left,n.left),r=t.top,l=Math.max(t.right,n.right),a=n.bottom;i=new DOMRect(o,r,l-o,a-r)}}return{range:t.cloneRange(),collapsed:o,text:n,rect:i,formats:this.getFormats(t)}}normalizeRange(e){let t=e.cloneRange();if(t.collapsed)return t;if(t.startContainer.nodeType===Node.TEXT_NODE&&t.startOffset===t.startContainer.length&&t.startContainer.nextSibling&&t.setStartBefore(t.startContainer.nextSibling),t.endContainer===this.contentEl&&t.endOffset>0){let e=this.contentEl.childNodes[t.endOffset-1];e&&t.setEndAfter(e)}if(0===t.endOffset&&t.endContainer!==this.contentEl){let e=t.endContainer;t.setEndBefore(e)}if(t.endContainer.nodeType===Node.ELEMENT_NODE&&t.endOffset>0){let e=t.endContainer.childNodes[t.endOffset-1];e&&"BR"===e.nodeName&&t.setEndBefore(e)}return t}getFormats(e){let t=this.doc.getSelection();if(!t||0===t.rangeCount)return this.getDefaultFormats();let n=e||t.getRangeAt(0),o=n.commonAncestorContainer;if(!n.collapsed){let e=n.startContainer,t=n.startOffset;if(e.nodeType===Node.TEXT_NODE&&t===e.length){let n=e.nextSibling;n&&(e=n,t=0)}for(;e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>t;){let n=e.childNodes[t];if(!n)break;n.nodeType!==Node.TEXT_NODE||n.textContent?.trim()||!n.nextSibling?(e=n,t=0):(e=n.nextSibling,t=0)}o=e}let i=o.nodeType===Node.TEXT_NODE?o.parentElement:o;if(!i||i!==this.contentEl&&!this.contentEl.contains(i))return this.getDefaultFormats();let r=(i.ownerDocument.defaultView||window).getComputedStyle(i),l=r.textDecorationLine||r.textDecoration||"",a=r.fontWeight,s="bold"===a||"bolder"===a||parseInt(a)>=700;return{bold:this.hasTag(i,"b")||this.hasTag(i,"strong")||s,italic:this.hasTag(i,"i")||this.hasTag(i,"em")||"italic"===r.fontStyle,underline:this.hasTag(i,"u")||l.includes("underline"),strike:this.hasTag(i,"s")||this.hasTag(i,"strike")||this.hasTag(i,"del")||l.includes("line-through"),code:this.hasTag(i,"code"),subscript:this.hasTag(i,"sub"),superscript:this.hasTag(i,"sup"),link:this.getLinkUrl(i),heading:this.getHeadingLevel(i),list:this.getListType(i),blockquote:this.hasTag(i,"blockquote"),align:this.getAlignment(i,r),fontSize:r.fontSize||null,fontFamily:r.fontFamily||null,color:r.color||null,backgroundColor:this.getExplicitBackground(i)}}getDefaultFormats(){return{bold:!1,italic:!1,underline:!1,strike:!1,code:!1,subscript:!1,superscript:!1,link:null,heading:null,list:null,blockquote:!1,align:"left",fontSize:null,fontFamily:null,color:null,backgroundColor:null}}getExplicitBackground(e){let t=e;for(;t&&t!==this.contentEl;){let e=t.style.backgroundColor;if(e&&"transparent"!==e&&""!==e||"span"===t.tagName.toLowerCase()&&e)return e;t=t.parentElement}return null}hasTag(e,t){let n=e;for(;n&&n!==this.contentEl;){if(n.tagName.toLowerCase()===t.toLowerCase())return!0;n=n.parentElement}return!1}getLinkUrl(e){let t=e;for(;t&&t!==this.contentEl;){if("a"===t.tagName.toLowerCase())return t.href||null;t=t.parentElement}return null}getHeadingLevel(e){let t=e;for(;t&&t!==this.contentEl;){let e=t.tagName.match(/^H([1-6])$/i);if(e)return parseInt(e[1]);t=t.parentElement}return null}getListType(e){let t=e;for(;t&&t!==this.contentEl;){if("ol"===t.tagName.toLowerCase())return"ordered";if("ul"===t.tagName.toLowerCase())return"unordered";t=t.parentElement}return null}getAlignment(e,t){let n=e;for(;n&&n!==this.contentEl;){let e=n.style.textAlign;if(e&&"inherit"!==e&&""!==e){let t=this.mapAlign(e);if(t)return t}let t=n.getAttribute("align");if(t){let e=this.mapAlign(t);if(e)return e}let o=n.tagName.toLowerCase();if(["p","div","h1","h2","h3","h4","h5","h6","li","blockquote","article","section"].includes(o)){let e=window.getComputedStyle(n).textAlign,t=this.mapAlign(e);if(t)return t}n=n.parentElement}return this.mapAlign(t.textAlign)||"left"}mapAlign(e){if(!e)return null;let t=e.toLowerCase();return"center"===t||t.includes("center")?"center":"right"===t||"end"===t?"right":"justify"===t||"full"===t?"justify":"left"===t||"start"===t?"left":null}saveSelection(e="manual"){if(this.isComposing)return;let t=this.doc.getSelection();if(t&&t.rangeCount>0){let n=t.getRangeAt(0);this.savedSnapshots.push({range:this.normalizeRange(n),timestamp:Date.now(),reason:e})}}restoreSelection(){let e=this.savedSnapshots.pop();if(!e)return!1;let t=this.doc.getSelection();return!!t&&(t.removeAllRanges(),t.addRange(e.range),!0)}clearSavedSelections(){this.savedSnapshots=[]}get snapshotCount(){return this.savedSnapshots.length}setSelection(e){let t=this.doc.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}selectAll(){let e=this.doc.createRange();e.selectNodeContents(this.contentEl),this.setSelection(e)}collapse(e=!1){let t=this.doc.getSelection();!t||0===t.rangeCount||(e?t.collapseToStart():t.collapseToEnd())}getCursorPosition(){let e=this.doc.getSelection();if(!e||0===e.rangeCount)return null;let t=e.getRangeAt(0),n=t.getBoundingClientRect();if(0===n.width&&0===n.height){let e=this.doc.createElement("span");e.textContent="​",t.insertNode(e);let n=e.getBoundingClientRect();return e.parentNode?.removeChild(e),{top:n.top,left:n.left,height:n.height||20}}return{top:n.top,left:n.left,height:n.height}}getSelectionRect(){let e=this.doc.getSelection();return e&&0!==e.rangeCount?e.getRangeAt(0).getBoundingClientRect():null}getSelectionOffsets(){let e=this.getSelection();if(!e||!e.range)return null;let t=e.range,n=t.cloneRange();n.selectNodeContents(this.contentEl),n.setEnd(t.startContainer,t.startOffset);let o=n.toString().length;return{start:o,end:o+t.toString().length}}},o=["p","br","hr","h1","h2","h3","h4","h5","h6","strong","b","em","i","u","s","strike","del","sup","sub","code","pre","blockquote","q","ul","ol","li","a","img","table","thead","tbody","tfoot","tr","th","td","div","span","figure","figcaption"],i={"*":["class","id","style","data-*"],a:["href","target","rel","title"],img:["src","alt","width","height","title"],td:["colspan","rowspan"],th:["colspan","rowspan","scope"]},r=["http","https","mailto","tel"],l=["script","style","iframe","object","embed","form","input","button"],a=class{constructor(e={}){this.config={allowedTags:e.allowedTags||o,allowedAttributes:e.allowedAttributes||i,allowedSchemes:e.allowedSchemes||r,stripEmpty:e.stripEmpty??!0}}sanitize(e){let t=(new DOMParser).parseFromString(e,"text/html").body;return this.processNode(t),t.innerHTML}processNode(e){let t=Array.from(e.childNodes);for(let e=t.length-1;e>=0;e--)this.processNode(t[e]);if(e.nodeType!==Node.ELEMENT_NODE)return;let n=e,o=n.tagName.toLowerCase();if(l.includes(o))return void n.remove();if(!this.config.allowedTags.includes(o)){let e=n.parentNode;if(e){for(;n.firstChild;)e.insertBefore(n.firstChild,n);n.remove()}return}let i=this.getAllowedAttributes(o),r=Array.from(n.attributes);for(let e of r)this.isAttributeAllowed(e.name,i)?(["href","src"].includes(e.name)&&(this.isUrlSafe(e.value)||n.removeAttribute(e.name)),e.name.startsWith("on")&&n.removeAttribute(e.name),"style"===e.name&&n.setAttribute("style",this.sanitizeStyle(e.value))):n.removeAttribute(e.name);this.config.stripEmpty&&this.isEmpty(n)&&!["br","hr","img"].includes(o)&&n.remove()}getAllowedAttributes(e){return[...this.config.allowedAttributes["*"]||[],...this.config.allowedAttributes[e]||[]]}isAttributeAllowed(e,t){if(t.includes(e))return!0;for(let n of t)if(n.endsWith("*")){let t=n.slice(0,-1);if(e.startsWith(t))return!0}return!1}isUrlSafe(e){try{if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../")||e.startsWith("data:image/"))return!0;let t=new URL(e,"http://example.com").protocol.slice(0,-1);return this.config.allowedSchemes.includes(t)}catch{return!1}}sanitizeStyle(e){let t=["expression","javascript:","behavior","binding","-moz-binding","url("],n=e;for(let e of t){let t=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");n=n.replace(t,"")}return n}isEmpty(e){return""===e.textContent?.trim()&&0===e.children.length}sanitizePaste(e){let t=e.replace(/<o:p[^>]*>[\s\S]*?<\/o:p>/gi,"").replace(/<\/?o:[^>]*>/gi,"").replace(/<!--\[if[^\]]*\]>[\s\S]*?<!\[endif\]-->/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<\/?xml[^>]*>/gi,"").replace(/<\/?st1:[^>]*>/gi,"").replace(/class="Mso[^"]*"/gi,"").replace(/style="[^"]*mso-[^"]*"/gi,"");return t=t.replace(/class="[^"]*docs-[^"]*"/gi,"").replace(/id="docs-[^"]*"/gi,""),t=t.replace(/\s+/g," ").replace(/>\s+</g,"><"),this.sanitize(t)}},s=class{constructor(e=100){this.stack=[],this.position=-1,this.debounceTimer=null,this.debounceDelay=300,this.lastContent="",this.maxSize=e}push(e,t){e!==this.lastContent&&(this.lastContent=e,this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.addEntry(e,t)},this.debounceDelay))}pushImmediate(e,t){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),e!==this.lastContent&&(this.lastContent=e,this.addEntry(e,t))}addEntry(e,t){this.stack=this.stack.slice(0,this.position+1),this.stack.push({html:e,selection:t,timestamp:Date.now()}),this.stack.length>this.maxSize?this.stack.shift():this.position++}undo(){return this.canUndo()?(this.position--,this.stack[this.position]):null}redo(){return this.canRedo()?(this.position++,this.stack[this.position]):null}canUndo(){return this.position>0}canRedo(){return this.position<this.stack.length-1}getCurrent(){return this.position<0||this.position>=this.stack.length?null:this.stack[this.position]}clear(){this.stack=[],this.position=-1,this.lastContent="",this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)}getStackSize(){return this.stack.length}getPosition(){return this.position}},c=class e{static{this.INLINE_TAGS=new Set(["strong","b","em","i","u","s","strike","del","sub","sup","code","span","a","mark"])}static{this.PRESERVE_EMPTY=new Set(["br","hr","img","input"])}constructor(e){this.contentEl=e}normalize(){this.mergeAdjacentInlines(this.contentEl),this.removeEmptyNodes(this.contentEl),this.flattenNestedInlines(this.contentEl),this.cleanWhitespace(this.contentEl),this.removeBrowserJunk(this.contentEl),this.contentEl.normalize()}mergeAdjacentInlines(e){let t=Array.from(e.childNodes);for(let e=0;e<t.length-1;e++){let n=t[e],o=t[e+1];if(n.nodeType===Node.ELEMENT_NODE&&o.nodeType===Node.ELEMENT_NODE){let t=n,i=o;if(this.canMerge(t,i)){for(;i.firstChild;)t.appendChild(i.firstChild);i.remove(),e--;continue}}n.nodeType===Node.ELEMENT_NODE&&this.mergeAdjacentInlines(n)}let n=e.lastChild;n&&n.nodeType===Node.ELEMENT_NODE&&this.mergeAdjacentInlines(n)}canMerge(t,n){if(t.tagName!==n.tagName||!e.INLINE_TAGS.has(t.tagName.toLowerCase())||t.attributes.length!==n.attributes.length)return!1;for(let e=0;e<t.attributes.length;e++){let o=t.attributes[e];if(n.getAttribute(o.name)!==o.value)return!1}return!0}removeEmptyNodes(t){let n=Array.from(t.childNodes);for(let t of n)if(t.nodeType===Node.ELEMENT_NODE){let n=t,o=n.tagName.toLowerCase();this.removeEmptyNodes(n),e.INLINE_TAGS.has(o)&&!e.PRESERVE_EMPTY.has(o)&&!n.hasChildNodes()&&!n.textContent?.trim()&&n.remove()}}flattenNestedInlines(t){let n=Array.from(t.childNodes);for(let t of n){if(t.nodeType!==Node.ELEMENT_NODE)continue;let n=t,o=n.tagName.toLowerCase();if(this.flattenNestedInlines(n),e.INLINE_TAGS.has(o)&&1===n.childNodes.length&&n.firstChild?.nodeType===Node.ELEMENT_NODE){let e=n.firstChild;if(e.tagName===n.tagName&&this.canMerge(n,e)){for(;e.firstChild;)n.insertBefore(e.firstChild,e);e.remove()}}}}cleanWhitespace(e){let t,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),o=[];for(;t=n.nextNode();)o.push(t);for(let e of o){let t=e.textContent||"";this.isInsidePreformatted(e)||(t=t.replace(/\u00A0{2,}/g,e=>" ".repeat(e.length)),t=t.replace(/ {3,}/g,"  "),t!==e.textContent&&(e.textContent=t))}}removeBrowserJunk(e){let t=Array.from(e.childNodes);for(let e of t){if(e.nodeType===Node.TEXT_NODE){if("​"===e.textContent||"\ufeff"===e.textContent){e.remove();continue}e.textContent&&/[\u200B\uFEFF]/.test(e.textContent)&&(e.textContent=e.textContent.replace(/[\u200B\uFEFF]/g,""))}if(e.nodeType===Node.ELEMENT_NODE){let t=e;if("span"===t.tagName.toLowerCase()&&!t.hasAttribute("style")&&!t.hasAttribute("class")&&!t.hasAttribute("data-type")&&0===t.attributes.length){for(;t.firstChild;)t.parentNode?.insertBefore(t.firstChild,t);t.remove();continue}this.removeBrowserJunk(t)}}}isInsidePreformatted(e){let t=e.parentNode;for(;t&&t!==this.contentEl;){if(t.nodeType===Node.ELEMENT_NODE){let e=t.tagName.toLowerCase();if("pre"===e||"code"===e)return!0}t=t.parentNode}return!1}},d={bold:e=>{e.getDocument().execCommand("bold",!1)},italic:e=>{e.getDocument().execCommand("italic",!1)},underline:e=>{e.getDocument().execCommand("underline",!1)},strike:e=>{e.getDocument().execCommand("strikeThrough",!1)},subscript:e=>{e.getDocument().execCommand("subscript",!1)},superscript:e=>{e.getDocument().execCommand("superscript",!1)},code:e=>{let t=e.getSelection();if(!t||t.collapsed)return;let n=e.getDocument(),o=t.range;if(o)if(t.formats.code){let e=u(o.commonAncestorContainer,"code");if(e){let t=e.parentNode;for(;e.firstChild;)t?.insertBefore(e.firstChild,e);e.remove()}}else{let e=n.createElement("code");e.appendChild(o.extractContents()),o.insertNode(e)}},clearFormat:e=>{e.getDocument().execCommand("removeFormat",!1)},heading:(e,t)=>{let n=t?`h${t}`:"p";e.getDocument().execCommand("formatBlock",!1,n)},paragraph:e=>{e.getDocument().execCommand("formatBlock",!1,"p")},blockquote:e=>{e.getSelection()?.formats.blockquote?e.getDocument().execCommand("formatBlock",!1,"p"):e.getDocument().execCommand("formatBlock",!1,"blockquote")},codeBlock:e=>{e.getDocument().execCommand("formatBlock",!1,"pre")},orderedList:e=>{e.getDocument().execCommand("insertOrderedList",!1)},unorderedList:e=>{e.getDocument().execCommand("insertUnorderedList",!1)},alignLeft:e=>{e.getDocument().execCommand("justifyLeft",!1)},alignCenter:e=>{e.getDocument().execCommand("justifyCenter",!1)},alignRight:e=>{e.getDocument().execCommand("justifyRight",!1)},alignJustify:e=>{e.getDocument().execCommand("justifyFull",!1)},indent:e=>{e.getDocument().execCommand("indent",!1)},outdent:e=>{e.getDocument().execCommand("outdent",!1)},link:(e,t)=>{if("string"!=typeof t)return;let n=e.getSelection();if(n)if(n.formats.link){let e=n.range;if(!e)return;let o=u(e.commonAncestorContainer,"a");o&&(o.href=t)}else n.collapsed||e.getDocument().execCommand("createLink",!1,t)},unlink:e=>{e.getDocument().execCommand("unlink",!1)},insertHR:e=>{e.getDocument().execCommand("insertHorizontalRule",!1)},insertHTML:(e,t)=>{"string"==typeof t&&e.getDocument().execCommand("insertHTML",!1,t)},insertText:(e,t)=>{"string"==typeof t&&e.getDocument().execCommand("insertText",!1,t)},selectAll:e=>{e.getDocument().execCommand("selectAll",!1)},undo:e=>{e.emit("undo")},redo:e=>{e.emit("redo")},setFontSize:(e,t)=>{if("string"!=typeof t&&"number"!=typeof t)return;let n=e.getSelection();if(!n||n.collapsed)return;let o=e.getDocument(),i=n.range;if(!i)return;let r=o.createElement("span");r.style.fontSize="number"==typeof t?`${t}px`:t,r.appendChild(i.extractContents()),i.insertNode(r)},setFontFamily:(e,t)=>{"string"==typeof t&&e.getDocument().execCommand("fontName",!1,t)},setColor:(e,t)=>{"string"==typeof t&&e.getDocument().execCommand("foreColor",!1,t)},setBackgroundColor:(e,t)=>{"string"==typeof t&&e.getDocument().execCommand("hiliteColor",!1,t)}};function u(e,t){let n=e;for(;n;){if(n.nodeType===Node.ELEMENT_NODE&&n.tagName.toLowerCase()===t.toLowerCase())return n;n=n.parentNode}return null}var g=[{key:"b",ctrl:!0,command:"bold"},{key:"i",ctrl:!0,command:"italic"},{key:"u",ctrl:!0,command:"underline"},{key:"z",ctrl:!0,command:"undo"},{key:"z",ctrl:!0,shift:!0,command:"redo"},{key:"y",ctrl:!0,command:"redo"},{key:"\\",ctrl:!0,command:"clearFormat"},{key:"k",ctrl:!0,command:"link"}],p=class{constructor(){this.commands=new Map}register(e){this.commands.set(e.name,e)}registerAll(e){e.forEach(e=>this.register(e))}get(e){return this.commands.get(e)}has(e){return this.commands.has(e)}getHandler(e){return this.commands.get(e)?.handler}getCommandState(e,t,n,o){let i=this.commands.get(e);if(!i)return null;let r=!!i.isActive&&i.isActive(t),l=!o,a=!o&&(!i.requiresSelection||n)&&(!i.isEnabled||i.isEnabled({format:t,hasSelection:n,readOnly:o})),s=i.getAttributes?i.getAttributes(t):void 0;return{name:i.name,label:i.label,category:i.category,type:i.type,active:r,supported:l,enabled:a,attributes:s,shortcut:i.shortcut,exclusiveGroup:i.exclusiveGroup,floatingToolbar:i.floatingToolbar,fixedToolbar:i.fixedToolbar,icon:i.icon,toolbarGroup:i.toolbarGroup,defaultArgs:i.defaultArgs}}getAllCommandStates(e,t,n){let o=[];return this.commands.forEach((i,r)=>{let l=this.getCommandState(r,e,t,n);l&&o.push(l)}),o}getToolbarCommands(e,t,n,o){let i=[];return this.commands.forEach((r,l)=>{if(!("floating"===e?r.floatingToolbar:r.fixedToolbar))return;let a=this.getCommandState(l,t,n,o);a&&i.push(a)}),i}getNames(){return Array.from(this.commands.keys())}getByCategory(e){let t=[];return this.commands.forEach(n=>{n.category===e&&t.push(n)}),t}getExclusiveGroup(e){let t=[];return this.commands.forEach(n=>{n.exclusiveGroup===e&&t.push(n)}),t}};function h(e){let t="string"==typeof e.target?document.querySelector(e.target):e.target;if(!t)throw new Error("Scribe: Target element not found");let o=e.iframe?.contentDocument||t.ownerDocument;if(!o)throw new Error("Scribe: Could not access document");let i=new n(o,t),r=new a(e.sanitize),l=new s,u=new c(t),h=new p,m=!1,f=e.readOnly??!1,b=null,y=new Map,v=new Map,x=[...g],C=new Map,E=t;f||(E.contentEditable="true"),E.classList.add("scribe-editor","scribe-content"),e.placeholder&&E.setAttribute("data-placeholder",e.placeholder),Object.entries(d).forEach(([e,t])=>{v.set(e,t)}),h.registerAll(function(e){return[{name:"undo",label:"Undo",category:"history",type:"action",handler:e.undo,icon:"undo",toolbarGroup:"history",shortcut:"Ctrl+Z",fixedToolbar:!0},{name:"redo",label:"Redo",category:"history",type:"action",handler:e.redo,icon:"redo",toolbarGroup:"history",shortcut:"Ctrl+Shift+Z",fixedToolbar:!0},{name:"bold",label:"Bold",category:"inline",type:"toggle",handler:e.bold,icon:"bold",toolbarGroup:"format",isActive:e=>e.bold,isEnabled:({format:e})=>!e.code,shortcut:"Ctrl+B",floatingToolbar:!0,fixedToolbar:!0},{name:"italic",label:"Italic",category:"inline",type:"toggle",handler:e.italic,icon:"italic",toolbarGroup:"format",isActive:e=>e.italic,isEnabled:({format:e})=>!e.code,shortcut:"Ctrl+I",floatingToolbar:!0,fixedToolbar:!0},{name:"underline",label:"Underline",category:"inline",type:"toggle",handler:e.underline,icon:"underline",toolbarGroup:"format",isActive:e=>e.underline,isEnabled:({format:e})=>!e.code,shortcut:"Ctrl+U",floatingToolbar:!0,fixedToolbar:!0},{name:"strike",label:"Strikethrough",category:"inline",type:"toggle",handler:e.strike,icon:"strikethrough",toolbarGroup:"format",isActive:e=>e.strike,isEnabled:({format:e})=>!e.code,floatingToolbar:!0,fixedToolbar:!0},{name:"code",label:"Inline Code",category:"inline",type:"toggle",handler:e.code,icon:"code",toolbarGroup:"format",isActive:e=>e.code,isEnabled:({format:e})=>!e.bold&&!e.italic,requiresSelection:!0,floatingToolbar:!0,fixedToolbar:!0},{name:"subscript",label:"Subscript",category:"inline",type:"toggle",handler:e.subscript,isActive:e=>e.subscript},{name:"superscript",label:"Superscript",category:"inline",type:"toggle",handler:e.superscript,isActive:e=>e.superscript},{name:"clearFormat",label:"Clear Formatting",category:"inline",type:"action",handler:e.clearFormat,icon:"removeFormatting",toolbarGroup:"misc",shortcut:"Ctrl+\\",fixedToolbar:!0},{name:"link",label:"Link",category:"insert",type:"apply",handler:e.link,icon:"link",toolbarGroup:"insert",isActive:e=>!!e.link,getAttributes:e=>e.link?{url:e.link}:void 0,shortcut:"Ctrl+K",floatingToolbar:!0,fixedToolbar:!0},{name:"unlink",label:"Unlink",category:"insert",type:"action",handler:e.unlink,isActive:e=>!!e.link},{name:"heading1",label:"Heading 1",category:"block",type:"apply",handler:e.heading,icon:"heading1",toolbarGroup:"block",isActive:e=>1===e.heading,exclusiveGroup:"blockType",defaultArgs:[1],floatingToolbar:!0,fixedToolbar:!0},{name:"heading2",label:"Heading 2",category:"block",type:"apply",handler:e.heading,icon:"heading2",toolbarGroup:"block",isActive:e=>2===e.heading,exclusiveGroup:"blockType",defaultArgs:[2],floatingToolbar:!0,fixedToolbar:!0},{name:"heading3",label:"Heading 3",category:"block",type:"apply",handler:e.heading,icon:"heading3",toolbarGroup:"block",isActive:e=>3===e.heading,exclusiveGroup:"blockType",defaultArgs:[3],fixedToolbar:!0},{name:"heading",label:"Heading",category:"block",type:"apply",handler:e.heading,isActive:e=>null!==e.heading,exclusiveGroup:"blockType"},{name:"paragraph",label:"Paragraph",category:"block",type:"apply",handler:e.paragraph,exclusiveGroup:"blockType"},{name:"blockquote",label:"Blockquote",category:"block",type:"toggle",handler:e.blockquote,icon:"quote",toolbarGroup:"block",isActive:e=>e.blockquote,floatingToolbar:!0,fixedToolbar:!0},{name:"codeBlock",label:"Code Block",category:"block",type:"apply",handler:e.codeBlock,exclusiveGroup:"blockType"},{name:"unorderedList",label:"Bullet List",category:"list",type:"toggle",handler:e.unorderedList,icon:"list",toolbarGroup:"list",isActive:e=>"unordered"===e.list,exclusiveGroup:"listType",floatingToolbar:!0,fixedToolbar:!0},{name:"orderedList",label:"Numbered List",category:"list",type:"toggle",handler:e.orderedList,icon:"listOrdered",toolbarGroup:"list",isActive:e=>"ordered"===e.list,exclusiveGroup:"listType",floatingToolbar:!0,fixedToolbar:!0},{name:"alignLeft",label:"Align Left",category:"alignment",type:"apply",handler:e.alignLeft,icon:"alignLeft",toolbarGroup:"align",isActive:e=>"left"===e.align,exclusiveGroup:"alignment",fixedToolbar:!0},{name:"alignCenter",label:"Align Center",category:"alignment",type:"apply",handler:e.alignCenter,icon:"alignCenter",toolbarGroup:"align",isActive:e=>"center"===e.align,exclusiveGroup:"alignment",fixedToolbar:!0},{name:"alignRight",label:"Align Right",category:"alignment",type:"apply",handler:e.alignRight,icon:"alignRight",toolbarGroup:"align",isActive:e=>"right"===e.align,exclusiveGroup:"alignment",fixedToolbar:!0},{name:"alignJustify",label:"Justify",category:"alignment",type:"apply",handler:e.alignJustify,icon:"alignJustify",toolbarGroup:"align",isActive:e=>"justify"===e.align,exclusiveGroup:"alignment"},{name:"indent",label:"Indent",category:"alignment",type:"action",handler:e.indent},{name:"outdent",label:"Outdent",category:"alignment",type:"action",handler:e.outdent},{name:"insertHR",label:"Horizontal Rule",category:"insert",type:"action",handler:e.insertHR},{name:"insertHTML",label:"Insert HTML",category:"insert",type:"action",handler:e.insertHTML},{name:"insertText",label:"Insert Text",category:"insert",type:"action",handler:e.insertText},{name:"setFontSize",label:"Font Size",category:"styling",type:"apply",handler:e.setFontSize,getAttributes:e=>e.fontSize?{size:e.fontSize}:void 0},{name:"setFontFamily",label:"Font Family",category:"styling",type:"apply",handler:e.setFontFamily,getAttributes:e=>e.fontFamily?{family:e.fontFamily}:void 0},{name:"setColor",label:"Text Color",category:"styling",type:"apply",handler:e.setColor,getAttributes:e=>e.color?{color:e.color}:void 0},{name:"setBackgroundColor",label:"Background Color",category:"styling",type:"apply",handler:e.setBackgroundColor,getAttributes:e=>e.backgroundColor?{color:e.backgroundColor}:void 0}]}(d));let k=(e,t)=>{let n=((e,t)=>{if(!e)return Object.keys(t);let n=[];for(let o of Object.keys(t))e[o]!==t[o]&&n.push(o);return n})(b,e);if(n.length>0){let o={previous:b,current:e,changed:n,source:t};w.emit("formatChange",o)}b={...e}},T=(t,...n)=>{if(f)return;let o=h.get(t),r=o?.handler||v.get(t);if(r){let t=n.length>0?n:o?.defaultArgs||[];r(w,...t),u.normalize(),l.push(E.innerHTML,null),w.emit("change",E.innerHTML),e.onChange?.(E.innerHTML);let a=i.getFormats();k(a,"command"),requestAnimationFrame(()=>{let e=i.getSelection();w.emit("selectionChange",e),e&&k(e.formats,"command")})}},w={getDocument:()=>o,getContentElement:()=>E,getSelection:()=>i.getSelection(),getFormatState:()=>{let e=i.getSelection();return e?e.formats:i.getFormats()},getCommandState:e=>{let t=w.getFormatState(),n=i.getSelection(),o=!!n&&!n.collapsed;return h.getCommandState(e,t,o,f)},getAllCommandStates:()=>{let e=w.getFormatState(),t=i.getSelection(),n=!!t&&!t.collapsed;return h.getAllCommandStates(e,n,f)},exec:(e,...t)=>T(e,...t),canExec:e=>!!w.getCommandState(e)?.enabled,bold:()=>T("bold"),italic:()=>T("italic"),underline:()=>T("underline"),strike:()=>T("strike"),code:()=>T("code"),subscript:()=>T("subscript"),superscript:()=>T("superscript"),clearFormat:()=>T("clearFormat"),heading:e=>T("heading",e),paragraph:()=>T("paragraph"),blockquote:()=>T("blockquote"),codeBlock:()=>T("codeBlock"),orderedList:()=>T("orderedList"),unorderedList:()=>T("unorderedList"),alignLeft:()=>T("alignLeft"),alignCenter:()=>T("alignCenter"),alignRight:()=>T("alignRight"),alignJustify:()=>T("alignJustify"),indent:()=>T("indent"),outdent:()=>T("outdent"),link:e=>T("link",e),unlink:()=>T("unlink"),insertHR:()=>T("insertHR"),insertHTML:e=>T("insertHTML",e),insertText:e=>T("insertText",e),setFontSize:e=>T("setFontSize",e),setFontFamily:e=>T("setFontFamily",e),setColor:e=>T("setColor",e),setBackgroundColor:e=>T("setBackgroundColor",e),undo:()=>w.emit("undo"),redo:()=>w.emit("redo"),getHTML:()=>E.innerHTML,setHTML:e=>{let t=r.sanitize(e);E.innerHTML=t,u.normalize(),l.pushImmediate(t,null),w.emit("change",t)},getText:()=>E.textContent||"",isEmpty:()=>""===(E.textContent?.trim()||"")&&E.children.length<=1,saveSelection:e=>i.saveSelection(e||"manual"),restoreSelection:()=>{let e=i.restoreSelection();if(e){let e=i.getSelection();w.emit("selectionChange",e),e&&k(e.formats,"selection")}return e},focus:()=>{E.focus(),w.restoreSelection(),w.emit("focus")},blur:()=>E.blur(),normalize:()=>u.normalize(),getPlugin:e=>y.get(e),isReadOnly:()=>f,setReadOnly:e=>{f=e,E.contentEditable=e?"false":"true",w.emit("readOnlyChange",e)},on:(e,t)=>{C.has(e)||C.set(e,new Set),C.get(e).add(t)},off:(e,t)=>{C.get(e)?.delete(t)},emit:(e,...t)=>{C.get(e)?.forEach(e=>e(...t))},destroy:()=>{m||(m=!0,y.forEach(e=>e.destroy?.()),y.clear(),E.removeEventListener("input",A),E.removeEventListener("keydown",S),E.removeEventListener("keyup",j),E.removeEventListener("mouseup",M),E.removeEventListener("paste",L),E.removeEventListener("focus",N),E.removeEventListener("blur",F),o.removeEventListener("selectionchange",B),E.contentEditable="false",E.classList.remove("scribe-editor","scribe-content"),E.removeAttribute("data-placeholder"),C.clear(),l.clear(),w.emit("destroy"))}},A=()=>{f||(l.push(E.innerHTML,null),w.emit("change",E.innerHTML),e.onChange?.(E.innerHTML))},S=e=>{if(!f)for(let t of x){let n=t.ctrl?e.ctrlKey||e.metaKey:!(e.ctrlKey||e.metaKey),o=t.shift?e.shiftKey:!e.shiftKey,i=t.alt?e.altKey:!e.altKey;if(e.key.toLowerCase()===t.key.toLowerCase()&&n&&o&&i)return e.preventDefault(),void T(t.command,...t.args||[])}},L=e=>{if(f)return;e.preventDefault();let t=e.clipboardData?.getData("text/html"),n=e.clipboardData?.getData("text/plain");if(t){let e=r.sanitizePaste(t);T("insertHTML",e)}else n&&T("insertText",n)},N=()=>{w.emit("focus"),e.onFocus?.()},F=()=>{w.emit("blur"),e.onBlur?.()},D=null,B=()=>{D&&cancelAnimationFrame(D),D=requestAnimationFrame(()=>{if(m)return;if(!i.isSelectionInContent())return void w.emit("selectionChange",null);let t=i.getSelection();w.emit("selectionChange",t),e.onSelectionChange?.(t);let n=t?t.formats:i.getFormats();k(n,"selection")})},M=()=>{setTimeout(B,10)},j=e=>{(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(e.key)||1===e.key.length)&&B()};return w.on("undo",()=>{let e=l.undo();e&&(E.innerHTML=e.html,w.emit("change",e.html))}),w.on("redo",()=>{let e=l.redo();e&&(E.innerHTML=e.html,w.emit("change",e.html))}),E.addEventListener("input",A),E.addEventListener("keydown",S),E.addEventListener("keyup",j),E.addEventListener("mouseup",M),E.addEventListener("paste",L),E.addEventListener("focus",N),E.addEventListener("blur",F),o.addEventListener("selectionchange",B),e.plugins?.forEach(e=>{y.set(e.name,e),e.commands&&Object.entries(e.commands).forEach(([e,t])=>{v.set(e,t)}),e.shortcuts&&x.push(...e.shortcuts),e.init?.(w)}),l.pushImmediate(E.innerHTML,null),e.autofocus&&setTimeout(()=>w.focus(),0),w.emit("ready"),w}var m={init:function(e,t={}){let n=document.querySelector(e);if(!n)throw new Error(`Scribe: Element "${e}" not found`);return h({target:n,mode:"inline",...t})},createEditor:h};let f=0;class b{instances=new Map;options;extraPlugins=[];constructor(e){this.options=e,e.plugins&&this.extraPlugins.push(...e.plugins)}registerPlugin(e){this.extraPlugins.push(e)}create(e,t={},n){const o=this.getByElement(e);if(o)return o;const i=`scribe-gjs-${++f}`;e.dataset.scribeId=i;const r={...this.options.scribeConfig,...t,plugins:[...this.options.scribeConfig?.plugins??[],...this.extraPlugins],onChange:e=>{n?.onChange?.(e),this.options.scribeConfig?.onChange?.(e)},onFocus:()=>{n?.onFocus?.(),this.options.scribeConfig?.onFocus?.()},onBlur:()=>{n?.onBlur?.(),this.options.scribeConfig?.onBlur?.()},onSelectionChange:e=>{this.options.debug&&console.log('[ScribeJS Debug] Selection changed:',e),n?.onSelectionChange?.(e),this.options.scribeConfig?.onSelectionChange?.(e)}},l=m.createEditor({target:e,...r});return this.instances.set(i,{id:i,element:e,scribe:l,cleanup:()=>{l.destroy(),this.instances.delete(i),delete e.dataset.scribeId}}),this.options.debug&&console.log(`[ScribeJS Plugin] Created instance ${i}`),l}destroyByElement(e){const t=e.dataset.scribeId;if(!t)return;const n=this.instances.get(t);n?.cleanup()}getByElement(e){const t=e.dataset.scribeId;if(t)return this.instances.get(t)?.scribe}destroyAll(){this.instances.forEach(e=>e.cleanup()),this.instances.clear()}getAll(){return this.instances}get size(){return this.instances.size}}const y=['#000000','#434343','#666666','#999999','#B7B7B7','#CCCCCC','#D9D9D9','#EFEFEF','#F3F3F3','#FFFFFF','#980000','#FF0000','#FF9900','#FFFF00','#00FF00','#00FFFF','#4A86E8','#0000FF','#9900FF','#FF00FF','#E6B8AF','#F4CCCC','#FCE5CD','#FFF2CC','#D9EAD3','#D0E0E3','#C9DAF8','#CFE2F3','#D9D2E9','#EAD1DC','#DD7E6B','#EA9999','#F9CB9C','#FFE599','#B6D7A8','#A2C4C9','#A4C2F4','#9FC5E8','#B4A7D6','#D5A6BD','#CC4125','#E06666','#F6B26B','#FFD966','#93C47D','#76A5AF','#6D9EEB','#6FA8DC','#8E7CC3','#C27BA0','#A61C00','#CC0000','#E69138','#F1C232','#6AA84F','#45818E','#3C78D8','#3D85C6','#674EA7','#A64D79'],v=[{type:'select',name:'formatBlock',label:'Text Style',group:'block',options:[{label:'Paragraph',value:'p'},{label:'Heading 1',value:'h1'},{label:'Heading 2',value:'h2'},{label:'Heading 3',value:'h3'},{label:'Heading 4',value:'h4'},{label:'Heading 5',value:'h5'},{label:'Heading 6',value:'h6'},{label:'Quote',value:'blockquote'}],getValue:e=>e.heading?`h${e.heading}`:e.blockquote?'blockquote':'p'},{type:'select',name:'fontFamily',label:'Font Family',group:'font',options:['Arial, sans-serif','Helvetica, sans-serif','Times New Roman, serif','Courier New, monospace','Verdana, sans-serif','Georgia, serif','Palatino, serif','Garamond, serif','Bookman, serif','Comic Sans MS, cursive'].map(e=>'string'==typeof e?{label:e.split(',')[0],value:e,style:`font-family: ${e}`}:e),getValue:e=>e.fontFamily||''},{type:'button',name:'bold',label:'Bold',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8"/></svg>',command:'bold',isActive:e=>e.bold,group:'inline'},{type:'button',name:'italic',label:'Italic',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/></svg>',command:'italic',isActive:e=>e.italic,group:'inline'},{type:'button',name:'underline',label:'Underline',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 4v6a6 6 0 0 0 12 0V4"/><line x1="4" y1="20" x2="20" y2="20"/></svg>',command:'underline',isActive:e=>e.underline,group:'inline'},{type:'button',name:'strike',label:'Strike',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16 4H9a3 3 0 0 0-2.83 4"/><path d="M14 12a4 4 0 0 1 0 8H6"/><line x1="4" y1="12" x2="20" y2="12"/></svg>',command:'strike',isActive:e=>e.strike,group:'inline'},{type:'color-picker',name:'color',label:'Text Color',icon:`<svg viewBox="0 0 24 24" aria-hidden="true">\n      <path d="M4 20h16"/>\n      <path d="m6 16 6-11 6 11"/>\n      <path d="M8 12h8"/>\n      <path class="color-indicator" d="M4 21h16" stroke-width="3" style="stroke: currentColor;"/>\n    </svg>`,command:'setColor',colors:y,getValue:e=>e.color||'',group:'color'},{type:'color-picker',name:'backgroundColor',label:'Highlight Color',icon:`<svg viewBox="0 0 24 24" aria-hidden="true">\n      <path d="m9 11-6 6v3h9l3-3"/>\n      <path d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"/>\n      <path class="color-indicator" d="M4 21h16" stroke-width="3" style="stroke: transparent;"/>\n    </svg>`,command:'setBackgroundColor',colors:y,getValue:e=>e.backgroundColor||'',group:'color'},{type:'button',name:'clearFormat',label:'Clear Formatting',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5h11a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-1"/><path d="M11 5v14"/><path d="M7 19h8"/><line x1="2" y1="2" x2="22" y2="22"/></svg>',command:'clearFormat',group:'inline'},{type:'button',name:'link',label:'Link',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',command:'link',isActive:e=>null!==e.link,group:'link'},{type:'button',name:'alignLeft',label:'Align Left',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><line x1="21" y1="6" x2="3" y2="6"/><line x1="15" y1="12" x2="3" y2="12"/><line x1="17" y1="18" x2="3" y2="18"/></svg>',command:'alignLeft',isActive:e=>'left'===e.align,group:'align'},{type:'button',name:'alignCenter',label:'Align Center',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><line x1="21" y1="6" x2="3" y2="6"/><line x1="19" y1="12" x2="5" y2="12"/><line x1="21" y1="18" x2="3" y2="18"/></svg>',command:'alignCenter',isActive:e=>'center'===e.align,group:'align'},{type:'button',name:'alignRight',label:'Align Right',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="12" x2="9" y2="12"/><line x1="21" y1="18" x2="7" y2="18"/></svg>',command:'alignRight',isActive:e=>'right'===e.align,group:'align'},{type:'button',name:'alignJustify',label:'Justify',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>',command:'alignJustify',isActive:e=>'justify'===e.align,group:'align'},{type:'button',name:'unorderedList',label:'Bullet list',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12h.01"/><path d="M3 18h.01"/><path d="M3 6h.01"/><path d="M8 12h13"/><path d="M8 18h13"/><path d="M8 6h13"/></svg>',command:'unorderedList',isActive:e=>'unordered'===e.list,group:'list'},{type:'button',name:'orderedList',label:'Numbered list',icon:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M10 12h11"/><path d="M10 18h11"/><path d="M10 6h11"/><path d="M4 10h2"/><path d="M4 6h1v4"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>',command:'orderedList',isActive:e=>'ordered'===e.list,group:'list'}];class x{toolbarEl=null;items=new Map;opts;activePopover=null;currentExecutor=null;listenersAttached=!1;constructor(e={}){this.opts={flex:!0,wrap:!0,responsive:!0,...e}}get element(){return this.toolbarEl}create(e=document){const t=e.createElement('div');t.className='scribe-gjs-toolbar',t.setAttribute('role','toolbar'),t.setAttribute('aria-label','Text formatting'),this.applyBaseStyles(t);const n=this.getItemNames();let o;for(const i of v){if(n&&!n.includes(i.name))continue;if(o&&i.group&&i.group!==o){const n=e.createElement('span');n.className='scribe-gjs-sep',n.setAttribute('aria-hidden','true'),t.appendChild(n)}const r=this.createItem(e,i);r.addEventListener('mousedown',e=>{e.preventDefault()}),t.appendChild(r),this.items.set(i.name,r),o=i.group??o}return this.toolbarEl=t,e.addEventListener('click',e=>{this.activePopover&&!this.activePopover.contains(e.target)&&this.closePopover()}),t}createItem(e,t){if('select'===t.type){const n=e.createElement('div');n.className='scribe-gjs-select-wrapper';const o=e.createElement('button');o.type='button',o.className='scribe-gjs-select-btn';const i=t.options?.find(e=>''===e.value)?.label||t.label||t.name;return o.innerHTML=`<span class="label">${i}</span><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>`,o.addEventListener('click',o=>{o.stopPropagation(),this.toggleSelect(e,n,t)}),n.appendChild(o),n}if('color-picker'===t.type){const n=e.createElement('div');n.className='scribe-gjs-color-wrapper';const o=e.createElement('button');return o.type='button',o.className='scribe-gjs-btn',t.label&&o.setAttribute('aria-label',t.label),t.icon&&(o.innerHTML=t.icon),o.addEventListener('click',o=>{o.stopPropagation(),this.toggleColorPicker(e,n,t)}),n.appendChild(o),n}{const n=e.createElement('button');return n.type='button',n.className='scribe-gjs-btn',t.command&&(n.dataset.command=t.command),n.dataset.name=t.name,t.label&&(n.title=t.label,n.setAttribute('aria-label',t.label)),n.setAttribute('aria-pressed','false'),t.icon&&t.icon.trim().startsWith('<')?n.innerHTML=t.icon:t.icon&&(n.textContent=t.icon),n}}toggleSelect(e,t,n){if(this.activePopover&&this.activePopover.parentElement===t)return void this.closePopover();this.closePopover();const o=e.createElement('div');o.className='scribe-gjs-select-dropdown',n.options?.forEach(i=>{if(''===i.value)return;const r=e.createElement('button');r.type='button',r.className='scribe-gjs-select-option',r.textContent=i.label,i.style&&(r.style.cssText=i.style),r.addEventListener('mousedown',e=>{e.preventDefault()}),r.addEventListener('click',e=>{e.stopPropagation();const o=new CustomEvent('select-changed',{detail:{value:i.value,name:n.name}});t.dispatchEvent(o),this.closePopover()});const l=n.getValue?n.getValue(this.lastFormats||{}):'',a=e=>e.toLowerCase().replace(/['"]/g,'').split(',')[0].trim();a(i.value)===a(l)&&(r.classList.add('active'),setTimeout(()=>r.scrollIntoView({block:'nearest'}),0)),o.appendChild(r)}),t.appendChild(o),this.activePopover=o}toggleColorPicker(e,t,n){if(this.activePopover&&this.activePopover.parentElement===t)return void this.closePopover();this.closePopover();const o=e.createElement('div');o.className='scribe-gjs-color-picker';const i=e.createElement('div');i.className='scribe-gjs-color-reset',i.textContent='Default',i.addEventListener('mousedown',e=>e.preventDefault()),i.addEventListener('click',e=>{e.stopPropagation();const o=new CustomEvent('color-selected',{detail:{color:'initial',command:n.command}});t.dispatchEvent(o),this.closePopover()}),o.appendChild(i);const r=e.createElement('div');r.className='scribe-gjs-color-grid',n.colors?.forEach(o=>{const i=e.createElement('button');i.type='button',i.className='scribe-gjs-color-swatch',i.style.backgroundColor=o,i.dataset.color=o,i.addEventListener('mousedown',e=>e.preventDefault()),i.addEventListener('click',e=>{e.stopPropagation();const i=new CustomEvent('color-selected',{detail:{color:o,command:n.command}});t.dispatchEvent(i),this.closePopover()}),r.appendChild(i)}),o.appendChild(r),t.appendChild(o),this.activePopover=o}closePopover(){this.activePopover&&(this.activePopover.remove(),this.activePopover=null)}bindCommands(e){this.currentExecutor=e,this.listenersAttached||(this.listenersAttached=!0,this.items.forEach((e,t)=>{const n=v.find(e=>e.name===t);n&&('select'===n.type?e.addEventListener('select-changed',e=>{if(!this.currentExecutor)return;const n=e.detail;if(!n||!n.value)return;const o=n.value;if('formatBlock'===t){if('p'===o)this.currentExecutor('paragraph');else if('blockquote'===o)this.currentExecutor('blockquote');else if(o.startsWith('h')){const e=parseInt(o.substring(1));this.currentExecutor('heading',e)}}else'fontFamily'===t&&this.currentExecutor('setFontFamily',o)}):'color-picker'===n.type?e.addEventListener('color-selected',e=>{if(!this.currentExecutor)return;const t=e.detail;if(t&&t.command){let e=t.color;'initial'===e&&(e='inherit'),this.currentExecutor(t.command,e)}}):e.addEventListener('click',()=>{if(this.currentExecutor&&n.command)if('link'===n.command){const t=document.querySelector('.link-modal'),n=document.querySelector('.link-modal-backdrop'),o=document.getElementById('link-url-input'),i=document.getElementById('link-remove'),r=document.getElementById('link-form');if(t&&n&&o&&r){const l=e.getBoundingClientRect();t.style.left=`${l.left}px`,t.style.top=`${l.bottom+8}px`,t.classList.add('visible'),n.classList.add('visible'),o.value='',o.focus();const a=()=>{t.classList.remove('visible'),n.classList.remove('visible')},s=e=>{e.preventDefault();const t=o.value;t&&this.currentExecutor&&this.currentExecutor('link',t),a(),r.removeEventListener('submit',s)};r.addEventListener('submit',s,{once:!0});const c=()=>{this.currentExecutor&&this.currentExecutor('unlink'),a(),i.removeEventListener('click',c)};i&&i.addEventListener('click',c,{once:!0}),n.onclick=a,document.getElementById('link-cancel').onclick=a}else{const e=prompt('Enter URL:');e&&this.currentExecutor('link',e)}}else this.currentExecutor(n.command)}))}))}lastFormats=null;updateState(e){e&&(this.lastFormats=e,this.items.forEach((t,n)=>{const o=v.find(e=>e.name===n);if(o)if('select'===o.type&&o.getValue){const n=o.getValue(e),i=t.querySelector('.scribe-gjs-select-btn .label');if(i){const e=e=>e.toLowerCase().replace(/['"]/g,'').split(',')[0].trim(),t=e(n),r=o.options?.find(n=>e(n.value)===t);i.textContent=r?r.label:n?n.split(',')[0].replace(/['"]/g,''):'Font Family'}}else if('color-picker'===o.type&&o.getValue){const i=o.getValue(e),r=t.querySelector('.color-indicator');r&&(i&&'inherit'!==i&&'initial'!==i&&'transparent'!==i?(r.style.stroke=i,r.style.display='block'):r.style.stroke='color'===n?'currentColor':'transparent')}else if('button'===o.type&&o.isActive){const n=o.isActive(e);t.classList.toggle('active',n),t.setAttribute('aria-pressed',String(n))}}))}positionNear(e,t){if(!this.toolbarEl)return;const n=this.toolbarEl,o=8;let i=e.left+e.width/2-n.offsetWidth/2,r=e.top-n.offsetHeight-o;if(t){r-=t.top,i-=t.left;const e=t.width;i<4&&(i=4),i+n.offsetWidth>e&&(i=e-n.offsetWidth-4)}else i<4&&(i=4),i+n.offsetWidth>window.innerWidth-4&&(i=window.innerWidth-n.offsetWidth-4);r<4&&(r=e.bottom+o-(t?.top??0)),n.style.top=`${r}px`,n.style.left=`${i}px`}show(){this.toolbarEl?.classList.add('visible')}hide(){this.toolbarEl?.classList.remove('visible'),this.closePopover()}destroy(){this.toolbarEl?.remove(),this.items.clear(),this.toolbarEl=null}getItemNames(){return this.opts.items&&0!==this.opts.items.length?this.opts.items.map(e=>'string'==typeof e?e:e.name):null}applyBaseStyles(e){e.style.display='flex',e.style.flexWrap='nowrap',e.style.whiteSpace='nowrap'}}function C(e){if(!e.getElementById('scribe-gjs-toolbar-styles')){const t=e.createElement('style');t.id='scribe-gjs-toolbar-styles',t.textContent=E,e.head.appendChild(t)}if(!e.querySelector('.link-modal')){const t=e.createElement('div');t.className='link-modal-backdrop';const n=e.createElement('div');n.className='link-modal',n.innerHTML=`\n        <form id="link-form">\n          <div class="input-group">\n            <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></svg>\n            <input type="text" id="link-url-input" placeholder="https://..." autocomplete="off">\n          </div>\n          <div class="actions">\n            <div class="left">\n              <button type="button" id="link-remove" class="remove" title="Remove link">\n                <svg viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></svg>\n              </button>\n            </div>\n            <div class="right">\n              <button type="button" id="link-cancel" class="cancel">Cancel</button>\n              <button type="submit" class="apply">Apply</button>\n            </div>\n          </div>\n        </form>\n      `,e.body.appendChild(t),e.body.appendChild(n)}}const E=`\n.scribe-gjs-toolbar {\n  display: none;\n  position: absolute;\n  transition: top 0.12s ease, left 0.12s ease;\n  gap: 4px;\n  padding: 8px;\n  background: hsl(0 0% 100%);\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 12px;\n  box-shadow: 0 12px 32px rgba(15, 23, 42, 0.12), 0 4px 8px rgba(15, 23, 42, 0.06);\n  z-index: 99999;\n  font-family: "Inter", system-ui, -apple-system, sans-serif;\n  \n  white-space: nowrap;\n  flex-wrap: nowrap;\n  align-items: center;\n  flex-direction: row;\n}\n.scribe-gjs-toolbar.visible { display: flex; }\n\n.scribe-gjs-btn {\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  color: hsl(222 47% 11% / 0.8);\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.15s ease;\n  user-select: none;\n  flex-shrink: 0;\n}\n.scribe-gjs-btn:hover {\n  background: hsl(210 20% 96%);\n  color: hsl(222 47% 11%);\n  transform: translateY(-1px);\n}\n.scribe-gjs-btn.active {\n  background: hsl(215 100% 95%);\n  color: hsl(215 80% 40%);\n}\n.scribe-gjs-btn svg {\n  width: 16px;\n  height: 16px;\n  stroke: currentColor;\n  fill: none;\n  stroke-width: 2;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n}\n\n/* Custom Select */\n.scribe-gjs-select-wrapper {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  margin-right: 4px;\n  flex-shrink: 0;\n}\n.scribe-gjs-select-btn {\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  background-color: hsl(210 20% 98%);\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 6px;\n  padding: 0 8px;\n  height: 32px;\n  font-size: 13px;\n  font-family: inherit;\n  color: hsl(222 47% 11%);\n  cursor: pointer;\n  font-weight: 500;\n  min-width: 80px;\n  max-width: 140px;\n  white-space: nowrap;\n  overflow: hidden;\n  gap: 6px;\n}\n.scribe-gjs-select-btn span {\n    flex: 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n.scribe-gjs-select-btn:hover {\n  border-color: hsl(214 32% 80%);\n  background-color: hsl(210 20% 96%);\n}\n.scribe-gjs-select-dropdown {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  margin-top: 4px;\n  background: white;\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 6px;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n  padding: 4px;\n  z-index: 100;\n  min-width: 140px;\n  max-height: 240px;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n}\n.scribe-gjs-select-option {\n  all: unset;\n  display: block;\n  padding: 6px 12px;\n  font-size: 13px;\n  color: hsl(222 47% 11%);\n  cursor: pointer;\n  border-radius: 4px;\n  text-align: left;\n}\n.scribe-gjs-select-option:hover {\n  background: hsl(210 20% 96%);\n}\n.scribe-gjs-select-option.active {\n  background: hsl(215 100% 95%);\n  color: hsl(215 80% 40%);\n  font-weight: 600;\n  border-left: 3px solid hsl(215 80% 40%);\n  padding-left: 9px;\n}\n\n.scribe-gjs-sep {\n  width: 1px;\n  height: 20px;\n  background: hsl(214 32% 90%);\n  align-self: center;\n  margin: 0 4px;\n  flex-shrink: 0;\n}\n\n/* Color Picker */\n.scribe-gjs-color-wrapper {\n  position: relative;\n  display: inline-flex;\n}\n.scribe-gjs-color-picker {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  margin-top: 8px;\n  background: white;\n  border: 1px solid hsl(214 32% 88%);\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n  padding: 8px;\n  z-index: 100;\n  width: 190px;\n}\n.scribe-gjs-color-reset {\n  display: block;\n  width: 100%;\n  padding: 6px;\n  text-align: center;\n  font-size: 12px;\n  color: hsl(222 47% 11%);\n  background: hsl(210 20% 96%);\n  border-radius: 4px;\n  cursor: pointer;\n  margin-bottom: 6px;\n  font-weight: 500;\n}\n.scribe-gjs-color-reset:hover {\n  background: hsl(214 32% 88%);\n}\n.scribe-gjs-color-grid {\n  display: grid;\n  grid-template-columns: repeat(10, 1fr);\n  gap: 2px;\n}\n.scribe-gjs-color-swatch {\n  width: 16px;\n  height: 16px;\n  border: 1px solid rgba(0,0,0,0.1);\n  border-radius: 2px;\n  padding: 0;\n  cursor: pointer;\n}\n.scribe-gjs-color-swatch:hover {\n  transform: scale(1.2);\n  z-index: 1;\n  border-color: rgba(0,0,0,0.3);\n}\n\n/* Link Modal */\n.link-modal-backdrop {\n    position: fixed;\n    inset: 0;\n    z-index: 99998;\n    background: rgba(0,0,0,0.1);\n    display: none;\n}\n.link-modal-backdrop.visible { display: block; }\n\n.link-modal {\n    position: fixed;\n    z-index: 99999; /* Higher than toolbar */\n    background: white;\n    border: 1px solid hsl(214 32% 88%);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.15);\n    padding: 12px;\n    min-width: 300px;\n    display: none;\n    font-family: 'Inter', sans-serif;\n}\n.link-modal.visible { display: block; }\n.link-modal input {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid hsl(214 32% 88%);\n    border-radius: 4px;\n    margin-bottom: 8px;\n    font-size: 14px;\n}\n.link-modal .actions {\n    display: flex;\n    justify-content: space-between;\n}\n.link-modal button {\n    padding: 6px 12px;\n    border-radius: 4px;\n    border: none;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 500;\n}\n.link-modal .apply {\n    background: hsl(173, 80%, 40%);\n    color: white;\n}\n.link-modal .cancel {\n    background: transparent;\n    color: #666;\n}\n.link-modal .remove {\n    background: transparent;\n    color: #ff4d4f;\n    padding: 6px;\n}\n.link-modal .input-group {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 8px;\n}\n.link-modal .input-group svg {\n    width: 16px; \n    height: 16px;\n    stroke: #999;\n    fill: none;\n    stroke-width: 2;\n}\n`;const k={scribeConfig:{},toolbar:{},iframe:void 0,externalToolbarContainer:null,outputFormat:'json',autoInit:!0,debug:!1,plugins:[],features:{tables:!0,media:!0,code:!0,collaboration:!1},debounceMs:100};function T(e,t={}){const n={...k,...t},o=new b(n);let i=null,r=null,l=null;function a(t){if(i)return i;var o;i=new x(n.toolbar),o=n.externalToolbarContainer,l=o?'string'==typeof o?document.querySelector(o):o:null;const r=l??e.RichTextEditor.getToolbarEl()??t.body,a=r?.ownerDocument??t,s=i.create(a);return l?(C(document),l.appendChild(s)):(C(a),r.appendChild(s)),i}const s=()=>setTimeout(()=>e.refresh(),0);e.setCustomRte({parseContent:!1,enable(t,i){const c=t.ownerDocument;let d=null;const u=()=>{const e=c.getSelection();if(!e||0===e.rangeCount)return;const n=e.getRangeAt(0),o=e.anchorNode,i=e.focusNode;o&&i&&t.contains(o)&&t.contains(i)&&(d=n.cloneRange())},g=a(c);if(function(e){const t='scribe-gjs-editor-styles';if(e.getElementById(t))return;const n=e.createElement('style');n.id=t,n.textContent=`\n    h1, h2, h3, h4, h5, h6 {\n      margin: 0 !important;\n      padding: 0 !important;\n    }\n  `,e.head.appendChild(n)}(c),i)return r=i,g.bindCommands((e,...t)=>{if(i)try{const n=i[e];'function'==typeof n&&(n.apply(i,t),u(),g.updateState(i.getSelection()?.formats||null))}finally{}}),i.focus(),g.show(),s(),i;const p=o.create(t,{},{onFocus:()=>{g.show(),s(),e.trigger('scribe:focus',{el:t})},onBlur:()=>{setTimeout(()=>{t.contains(c.activeElement)},150)},onSelectionChange:n=>{const o=n;o&&(g.updateState(o.formats),u()),o&&o.rect&&(g.show(),s()),e.trigger('scribe:selectionChange',{el:t,selection:n})}});return g.bindCommands((e,...t)=>{if(p)try{const n=p[e];'function'==typeof n&&(n.apply(p,t),u(),g.updateState(p.getSelection()?.formats||null))}finally{}}),r=p,p.focus(),g.show(),s(),n.onToolbar&&l&&n.onToolbar(l),e.trigger('scribe:ready',{el:t,instance:p}),n.debug&&console.log('[ScribeJS Plugin] Enabled on element',t),p},disable(e,t){i?.hide(),r=null,n.debug&&console.log('[ScribeJS Plugin] Disabled on element',e)},getContent:(e,t)=>t?t.getHTML():e.innerHTML,...n.customRte}),e.on('destroy',()=>{o.destroyAll(),i?.destroy(),i=null,r=null,l=null}),e.on('rteToolbarPosUpdate',e=>{const{elRect:t,targetHeight:n,canvasRect:o}=e,i=o?.top??0;o?.bottom??window.innerHeight;t.top-i>n+10+40?(e.top=-60,e.bottom=''):(e.top='',e.bottom=-6),e.left=0,e.right=''}),e.on('canvasScroll',()=>{s()});const c={createInstance:(e,t)=>o.create(e,t),destroyInstance:e=>o.destroyByElement(e),getInstance:e=>o.getByElement(e),destroyAll:()=>o.destroyAll(),registerPlugin:e=>o.registerPlugin(e),getInstances:()=>o.getAll()};e.ScribeJS=c,n.debug&&console.log('[ScribeJS Plugin] Initialised with options',n)}return t})());
//# sourceMappingURL=index.js.map